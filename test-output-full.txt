
> matchina@0.1.1 test
> vitest run --coverage


[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90m/Users/winston/dev/personal/matchina[39m
      [2mCoverage enabled with [22m[33mv8[39m

 [32mâœ“[39m test/matchbox.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 10[2mms[22m[39m
[90mstdout[2m | test/store-machine.test.ts[2m > [22m[2mcreateStoreMachine[2m > [22m[2mshould support complex state updates
[22m[39mhello

 [32mâœ“[39m test/store-machine.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m test/declarative-flat.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 16[2mms[22m[39m
 [32mâœ“[39m test/shape-store-coverage.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 6[2mms[22m[39m
[90mstdout[2m | test/promise.test.ts[2m > [22m[2mcreatePromiseMachine[2m > [22m[2mshould transition to Rejected state on error
[22m[39mPromise rejected: Error: custom error
    at [90m/Users/winston/dev/personal/matchina/[39mtest/promise.test.ts:69:15
sending reject
relaying rejection
machine state MatchboxImpl {
  data: Error: custom error
      at [90m/Users/winston/dev/personal/matchina/[39mtest/promise.test.ts:69:15,
  key: [32m'Rejected'[39m,
  getTag: [36m[Function: getTag][39m
}

 [32mâœ“[39m test/effects.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 9[2mms[22m[39m
 [32mâœ“[39m test/state-machine-hook-adapters.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m test/promise.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 14[2mms[22m[39m
[90mstdout[2m | test/propagate-submachines-real.test.ts[2m > [22m[2mpropagateSubmachines - REAL TESTS[2m > [22m[2mDEBUG: show what handleAtRoot is doing
[22m[39mBefore send - child: Idle
Before send - parent: Idle
After send - child: Active
After send - parent: Idle
Send result: FactoryMachineEventImpl {
  type: [32m'start'[39m,
  from: MatchboxImpl {
    data: { key: [32m'Child.Idle'[39m },
    key: [32m'Idle'[39m,
    getTag: [36m[Function: getTag][39m
  },
  to: MatchboxImpl {
    data: { key: [32m'Child.Active'[39m },
    key: [32m'Active'[39m,
    getTag: [36m[Function: getTag][39m
  },
  params: [],
  machine: [90mundefined[39m
}

[90mstdout[2m | test/on-lifecycle.test.ts[2m > [22m[2monLifecycle usage[2m > [22m[2mshould call guard, handle, and event hooks in lifecycle order
[22m[39mtest guard reject
GUARD executing
Idle wants to executing to Pending with params [object Promise], 1
  GUARD accept? [33mfalse[39m
state Idle
test guard accept, handler reject
GUARD executing
Idle wants to executing to Pending with params [object Promise], 99
  GUARD accept? [33mtrue[39m
*** HANDLE
handler rejecting
Transition aborted by handle FactoryMachineEventImpl {
  type: [32m'executing'[39m,
  from: MatchboxImpl {
    data: [90mundefined[39m,
    key: [32m'Idle'[39m,
    getTag: [36m[Function: getTag][39m
  },
  to: MatchboxImpl {
    data: { promise: [36m[Promise][39m, params: [36m[Array][39m },
    key: [32m'Pending'[39m,
    getTag: [36m[Function: getTag][39m
  },
  params: [ Promise { [33m99[39m }, [ [33m99[39m ] ],
  machine: [90mundefined[39m
}
BEFORE FAIL Idle
***test handler accept
GUARD executing
Idle wants to executing to Pending with params [object Promise], 100
  GUARD accept? [33mtrue[39m
*** HANDLE
handler accepting
BEFORE executing
executing Promise { [33m100[39m }
* before executing
* before done
* leaving Idle
LLLLLEEEAAAVVVIIINNNGGGG FactoryMachineEventImpl {
  type: [32m'executing'[39m,
  from: MatchboxImpl {
    data: [90mundefined[39m,
    key: [32m'Idle'[39m,
    getTag: [36m[Function: getTag][39m
  },
  to: MatchboxImpl {
    data: { promise: [36m[Promise][39m, params: [36m[Array][39m },
    key: [32m'Pending'[39m,
    getTag: [36m[Function: getTag][39m
  },
  params: [ Promise { [33m100[39m }, [ [33m100[39m ] ],
  machine: [90mundefined[39m,
  promise: Promise { [33m100[39m },
  done: Promise { [90mundefined[39m }
}
leaving Idle to executing to Pending
* entering Pending
entering Pending via executing
* after executing
AFTER Execute Pending
In Pending before resolve
done before resolve
* before resolve
* before done
* leaving Pending
* entering Resolved
* after resolve
Resolved from Pending
AFTER delay Resolved
* before reset
* before done
* leaving Resolved
* entering Idle
* after reset
GUARD executing
Idle wants to executing to Pending with params [object Promise], 100
  GUARD accept? [33mtrue[39m
*** HANDLE
handler accepting
BEFORE executing
executing Promise { [36m<pending>[39m }
* before executing
* before done
* leaving Idle
LLLLLEEEAAAVVVIIINNNGGGG FactoryMachineEventImpl {
  type: [32m'executing'[39m,
  from: MatchboxImpl {
    data: [90mundefined[39m,
    key: [32m'Idle'[39m,
    getTag: [36m[Function: getTag][39m
  },
  to: MatchboxImpl {
    data: { promise: [36m[Promise][39m, params: [36m[Array][39m },
    key: [32m'Pending'[39m,
    getTag: [36m[Function: getTag][39m
  },
  params: [ Promise { [36m<pending>[39m }, [ [33m100[39m ] ],
  machine: [90mundefined[39m,
  promise: Promise { [36m<pending>[39m },
  done: Promise { [36m<pending>[39m }
}
leaving Idle to executing to Pending
* entering Pending
entering Pending via executing
* after executing
* before reject
* before done
* leaving Pending
something Rejected from Pending
* entering Rejected
* after reject
removing lifecycle
* before reset
* before done
* leaving Rejected
* entering Idle
* after reset
resetting
executing without lifecycle
GUARD executing
Idle wants to executing to Pending with params [object Promise], 1000
  GUARD accept? [33mtrue[39m
*** HANDLE
handler accepting
BEFORE executing
executing Promise { [36m<pending>[39m }
* before executing
* before done
* leaving Idle
LLLLLEEEAAAVVVIIINNNGGGG FactoryMachineEventImpl {
  type: [32m'executing'[39m,
  from: MatchboxImpl {
    data: [90mundefined[39m,
    key: [32m'Idle'[39m,
    getTag: [36m[Function: getTag][39m
  },
  to: MatchboxImpl {
    data: { promise: [36m[Promise][39m, params: [36m[Array][39m },
    key: [32m'Pending'[39m,
    getTag: [36m[Function: getTag][39m
  },
  params: [ Promise { [36m<pending>[39m }, [ [33m1000[39m ] ],
  machine: [90mundefined[39m,
  promise: Promise { [36m<pending>[39m },
  done: Promise { [36m<pending>[39m }
}
leaving Idle to executing to Pending
* entering Pending
entering Pending via executing
* after executing
In Pending before resolve
done before resolve
* before resolve
* before done
* leaving Pending
* entering Resolved
* after resolve
Resolved from Pending
{
  didGuardReject: [33m1[39m,
  didGuardAccept: [33m2[39m,
  didHandlerReject: [33m3[39m,
  didHandleExecute: [33m4[39m,
  didBeforeExecute: [33m5[39m,
  didLeaveIdle: [33m6[39m,
  didEnterPending: [33m7[39m,
  didBeforeResolve: [33m8[39m,
  didAfterResolve: [33m9[39m,
  didEnterRejected: [33m10[39m
}

 [32mâœ“[39m test/on-lifecycle.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 180[2mms[22m[39m
 [32mâœ“[39m test/examples/hsm-combobox-flat.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 141[2mms[22m[39m
 [32mâœ“[39m test/propagate-submachines-real.test.ts [2m([22m[2m28 tests[22m[2m)[22m[32m 130[2mms[22m[39m
 [32mâœ“[39m test/hsm-visualization-unified.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 20[2mms[22m[39m
 [32mâœ“[39m test/hsm-nesting-typed.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 4[2mms[22m[39m
 [32mâœ“[39m test/guard-execute.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 4[2mms[22m[39m
 [32mâœ“[39m test/examples/hsm-traffic-light-flat.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 5[2mms[22m[39m
 [32mâœ“[39m test/factory-machine-event.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 4[2mms[22m[39m
 [32mâœ“[39m test/factory-machine-hooks.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 4[2mms[22m[39m
 [32mâœ“[39m test/match-case.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 4[2mms[22m[39m
 [32mâœ“[39m test/store-machine-api.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 4[2mms[22m[39m
 [32mâœ“[39m test/method.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 5[2mms[22m[39m
 [32mâœ“[39m test/machine.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 5[2mms[22m[39m
 [32mâœ“[39m test/lifecycle.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 5[2mms[22m[39m
 [32mâœ“[39m test/matchina.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m test/state-machine-actions.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m test/states.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m test/enhance-method-bug.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 2[2mms[22m[39m
 [32mâœ“[39m test/typeguards.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 2[2mms[22m[39m
 [32mâœ“[39m test/usage.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m test/with-subscribe.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 3[2mms[22m[39m

[2m Test Files [22m [1m[32m28 passed[39m[22m[90m (28)[39m
[2m      Tests [22m [1m[32m178 passed[39m[22m[90m (178)[39m
[2m   Start at [22m 00:13:36
[2m   Duration [22m 1.05s[2m (transform 1.82s, setup 371ms, import 2.63s, tests 602ms, environment 3ms)[22m

[34m % [39m[2mCoverage report from [22m[33mv8[39m
-------------------|---------|----------|---------|---------|-------------------
File               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
-------------------|---------|----------|---------|---------|-------------------
All files          |   78.98 |    67.29 |   79.52 |   79.35 |                   
 src               |   96.32 |    91.47 |   96.96 |   96.56 |                   
  define-states.ts |     100 |      100 |     100 |     100 |                   
  env.d.ts         |       0 |        0 |       0 |       0 |                   
  ...-lifecycle.ts |     100 |      100 |     100 |     100 |                   
  ...-api-types.ts |       0 |        0 |       0 |       0 |                   
  ...-event-api.ts |     100 |      100 |     100 |     100 |                   
  ...hine-event.ts |     100 |      100 |     100 |     100 |                   
  ...hine-hooks.ts |     100 |      100 |     100 |     100 |                   
  ...ycle-types.ts |       0 |        0 |       0 |       0 |                   
  ...-lifecycle.ts |     100 |       90 |     100 |     100 | 124-147           
  ...hine-types.ts |       0 |        0 |       0 |       0 |                   
  ...ry-machine.ts |   96.66 |      100 |     100 |   96.55 | 128               
  machine-brand.ts |     100 |      100 |     100 |     100 |                   
  ...case-types.ts |       0 |        0 |       0 |       0 |                   
  match-case.ts    |     100 |      100 |     100 |     100 |                   
  ...ange-types.ts |       0 |        0 |       0 |       0 |                   
  match-change.ts  |     100 |      100 |     100 |     100 |                   
  ...lter-types.ts |       0 |        0 |       0 |       0 |                   
  match-filters.ts |     100 |      100 |     100 |     100 |                   
  ...tory-types.ts |       0 |        0 |       0 |       0 |                   
  ...ox-factory.ts |   97.22 |    95.23 |     100 |   97.14 | 72                
  matchina.ts      |     100 |      100 |     100 |     100 |                   
  ...hine-hooks.ts |     100 |      100 |     100 |     100 |                   
  ...chine-impl.ts |     100 |     87.5 |     100 |     100 | 90                
  promise-types.ts |       0 |        0 |       0 |       0 |                   
  ...ne-actions.ts |     100 |      100 |     100 |     100 |                   
  ...k-adapters.ts |     100 |      100 |     100 |     100 |                   
  ...hine-hooks.ts |     100 |      100 |     100 |     100 |                   
  ...chine-pure.ts |     100 |      100 |     100 |     100 |                   
  ...hine-types.ts |       0 |        0 |       0 |       0 |                   
  state-types.ts   |       0 |        0 |       0 |       0 |                   
  store-brand.ts   |   66.66 |        0 |      50 |   66.66 | 13                
  ...achine-api.ts |     100 |      100 |     100 |     100 |                   
  store-machine.ts |     100 |      100 |     100 |     100 |                   
  ...ion-helper.ts |      20 |    44.44 |      50 |   22.22 | 22-39             
  utility-types.ts |       0 |        0 |       0 |       0 |                   
 src/dev           |       0 |        0 |       0 |       0 |                   
  ...emberTypes.ts |       0 |      100 |       0 |       0 | 50                
  ...hine-hooks.ts |       0 |        0 |       0 |       0 | 14-149            
  ...on-helpers.ts |       0 |      100 |       0 |       0 | 4-37              
 src/ext           |   81.25 |        0 |   88.88 |      75 |                   
  ...nt-handler.ts |       0 |        0 |       0 |       0 |                   
  ...e-property.ts |       0 |        0 |       0 |       0 | 35-37             
  setup.ts         |     100 |      100 |     100 |     100 |                   
 src/ext/funcware  |     100 |      100 |     100 |     100 |                   
  abortable.ts     |     100 |      100 |     100 |     100 |                   
  ...middleware.ts |     100 |      100 |     100 |     100 |                   
  iff.ts           |     100 |      100 |     100 |     100 |                   
  tap.ts           |     100 |      100 |     100 |     100 |                   
 ...ext/methodware |     100 |    83.33 |     100 |     100 |                   
  ...e-function.ts |     100 |       75 |     100 |     100 | 104               
  ...nce-method.ts |     100 |     87.5 |     100 |     100 | 27                
  ...d-enhancer.ts |     100 |      100 |     100 |     100 |                   
  ...lity-types.ts |       0 |        0 |       0 |       0 |                   
 src/extras        |   94.33 |       75 |      92 |   94.11 |                   
  bind-effects.ts  |     100 |      100 |     100 |     100 |                   
  delay.ts         |     100 |      100 |     100 |     100 |                   
  effects.ts       |     100 |      100 |     100 |     100 |                   
  emitter.ts       |     100 |      100 |     100 |     100 |                   
  ...exit-types.ts |       0 |        0 |       0 |       0 |                   
  iff.ts           |       0 |        0 |       0 |       0 | 16-18             
  when.ts          |     100 |      100 |     100 |     100 |                   
  with-reset.ts    |     100 |    66.66 |     100 |     100 | 67                
  ...-subscribe.ts |     100 |       50 |     100 |     100 | 36                
  zen.ts           |     100 |      100 |     100 |     100 |                   
 src/integrations  |       0 |        0 |       0 |       0 |                   
  react.ts         |       0 |        0 |       0 |       0 | 5-63              
  valibot.ts       |       0 |        0 |       0 |       0 | 40-50             
  zod.ts           |       0 |      100 |       0 |       0 | 38-44             
 src/nesting       |   75.67 |    60.55 |   92.15 |    76.1 |                   
  ...ative-flat.ts |   93.33 |    88.88 |   83.33 |   94.82 | 194,237,245       
  flat-machine.ts  |     100 |      100 |     100 |     100 |                   
  ...child-exit.ts |    93.1 |    88.88 |     100 |    93.1 | 58,77             
  ...n-fallback.ts |   74.07 |    59.09 |     100 |   74.07 | 59-76             
  ...ubmachines.ts |    64.2 |    51.58 |   85.71 |   63.29 | ...09-318,350-359 
  ...e-builders.ts |   74.15 |    46.26 |     100 |      75 | ...83-188,203-215 
  shape-store.ts   |     100 |      100 |     100 |     100 |                   
  shape-types.ts   |       0 |        0 |       0 |       0 |                   
-------------------|---------|----------|---------|---------|-------------------
