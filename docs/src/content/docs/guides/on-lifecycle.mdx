---
title: Lifecycle & Hooks
description: Intercept and react to state changes with lifecycle hooks
---

import { LifecycleDemo } from "@components/LifecycleDemo";
import { Tabs, TabItem } from '@astrojs/starlight/components';


The `onLifecycle` function lets you intercept all sorts of state changes and events in your machine through a single hook call and configuration. 


```ts
onLifecycle(machine, {
  SomeStateKey: {
    enter: ({ from, to }) => { /* ... */ },
    exit: ({ from, to }) => { /* ... */ },
    on: {
      someEventType: {
        before: ({ type }) => { /* ... */ },
        after: ({ type }) => { /* ... */ },
      },
    },
  },
  "*": {
    on: {
      "*": {
        after: (ev) => { /* ... */ },
      },
    },
  },
});
```

## `onLifecycle` Configuration

Its configuration options are organized as follows:

- **State names** (e.g. `Idle`, `Pending`) are top-level keys. Use `"*"` for all states.
- **Hooks** like `enter`, `exit`, and `on` go inside each state:
  - `enter`: runs when entering the state.
  - `exit`: runs when exiting the state.
  - `on`: handles events within the state.

Inside `on`, **event names** (e.g. `execute`, `reject`, `resolve`) are keys. Use `"*"` for all events.

Each event or hook can have:
- `before`: runs before the transition.
- `after`: runs after the transition.

## Interactive Example

<div className="not-content">
  <LifecycleDemo client:only="react" />
</div>

Here's the onLifecycle logging code behind this example:

```ts
 onLifecycle(machine, {
  Idle: {
    on: {
      executing: {
        after: ({ type, from, to, params }) => {
          console.log(
            "after Idle.executing:",
            type,
            from.key,
            to.key,
            Object.keys(params),
          );
        },
      },
    },
  },
  "*": {
    on: {
      "*": {
        after: (ev) => {
          console.log(`[${ev.type}]:`, ev.to.key, ev.to.data);
        },
      },
      reject: {
        after: ({ type, from, to }) => {
          const { name, stack, message } = to.data;
          console.log(
            "after",
            type,
            "from",
            from.key,
            name,
            message,
            stack,
          );
        },
      },
      resolve: {
        before: ({ type, from: _from, to: { data } }) => {
          console.log("before", type, data);
        },
      },
    },
  },
})
```


## Next Steps

Now that you understand lifecycle hooks, explore these related guides:

- [Effects](/guides/effects) - Learn about the dedicated effects system
- [Factory Machines](/guides/machines) - Create complete state machines
- [Promise Machines](/guides/promises) - Handle async operations with state machines
- [React Integration](/guides/integrations) - Use lifecycle hooks with React
```
