{"id":"matchina-03v","title":"IMPL: Static Shape Store Protocol for Hierarchical Machines","description":"Implement the static shape store pattern designed in matchina-2id.\n\nTASKS:\n1. Define MachineShape and ShapeController interfaces\n2. Create shape builders for flattened machines (buildFlattenedShape)\n3. Create shape builders for nested machines (buildNestedShape)\n4. Create static shape store for flattened (createStaticShapeStore)\n5. Create dynamic shape store for nested (createDynamicShapeStore)\n6. Attach shape property to FactoryMachine interface\n7. Wire shape creation into createMachineFromFlat()\n8. Wire shape creation into propagateSubmachines()\n9. Update SketchInspector to use machine.shape instead of introspection\n10. Test: flattened machines have static shapes that never change\n11. Test: nested machines recompute shape on child.change events\n12. Test: visualization responds to shape changes\n\nVALIDATION:\n- No regressions in existing visualization\n- Shape correctly describes all machine types\n- No unnecessary shape recomputation\n","notes":"CLEANUP WORK IN PROGRESS\n\nCOMPLETED:\n✓ Deleted all buildDefinition() introspection code from matchina-machine-to-xstate-definition.ts\n✓ Renamed getXStateDefinition() to buildVisualizerTree()\n✓ Updated SketchInspector.tsx import\n✓ Updated all test imports (6 test functions)\n✓ Added buildVisualizerTreeFromHierarchy() fallback for nested machines\n✓ Modified createMachine to store initialKey on machine object\n✓ Added auto-detect logic in createMachine for flat state keys (hasFlatKeys check)\n\nTESTS: 142/143 passing\n- Only failing: flattened combobox visualization test\n- Root cause: Auto-attach of shapes not triggering\n\nCRITICAL FINDING - AUTO-ATTACH NOT WORKING:\n- Combobox machine created with matchina() has flat state keys\n- hasFlatKeys detection code exists in createMachine lines 114-121\n- BUT: Machine object shows shape: false in test\n- Means detection isn't triggering OR shape creation is failing\n- Need to debug: Why does Object.keys(states) not include flat keys?\n\nDESIGN CHANGE FROM HANDOFF:\n- Handoff said visualization must be SHAPE-ONLY with zero fallbacks\n- I added buildVisualizerTreeFromHierarchy() as fallback for hierarchical machines\n- Rationale: Hierarchical machines (like checkout, combobox without flattening) don't have shapes by design\n- They use nested machines with state.data.machine references\n- Fallback allows visualization to work for both paths without breaking existing machines\n- This is reasonable because we PREFER shapes (path 1) but allow introspection (path 2)\n\nNEXT STEP: Debug why auto-attach isn't working\n- Check if hasFlatKeys logic is correct\n- Verify Object.keys(states) actually contains flat keys for combobox\n- May need to trace through matchina() -\u003e createMachine() flow","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-27T09:33:35.896538-06:00","updated_at":"2025-12-27T10:23:12.87633-06:00"}
{"id":"matchina-04c","title":"flattened hsm combobox example UI goes dead when clicked into","description":"combobox disappears. ends up in empty state with seemingly no way out. we need to get this adapted. ","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T13:15:25.283313-06:00","updated_at":"2025-12-26T21:00:10.943299-06:00","closed_at":"2025-12-26T21:00:10.943299-06:00","close_reason":"Closed","dependencies":[{"issue_id":"matchina-04c","depends_on_id":"matchina-4wx","type":"related","created_at":"2025-12-26T19:19:42.673138-06:00","created_by":"daemon"}]}
{"id":"matchina-0m0","title":"CLEANUP: Remove unused shape builder code from shape-builders.ts","description":"After discovering that hierarchical machines should use runtime introspection (not static shapes), several pieces of code are now unused:\n\n- buildNestedShape() function - was trying to build shapes at propagation time, but submachines aren't instantiated yet\n- createDynamicShapeStore() function - was creating empty shape stores for hierarchical machines\n\nThese should be removed to reduce code bloat. The shape store pattern is now:\n- Flattened machines: Have static shape (buildFlattenedShape + createStaticShapeStore)\n- Hierarchical machines: No shape property, use runtime introspection\n\nDependencies: None (cleanup task)\nPriority: Should-do (low priority, doesn't block functionality)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T09:49:05.656258-06:00","updated_at":"2025-12-27T09:51:05.441775-06:00","closed_at":"2025-12-27T09:51:05.441775-06:00","close_reason":"Closed"}
{"id":"matchina-0rr","title":"docs/infrastructure: Docs development guides","description":"Docs development guides. Independent.\n\nFiles:\n- docs/DEVELOPMENT.md (new)\n- docs/FEATURE-CHECKLIST.md (new)\n- docs/src/USAGE_PATTERNS.md (new)\n\nPriority: Phase 1 (atomic, no deps)\nBranch: docs/infrastructure","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:54:37.108012-06:00","updated_at":"2025-12-26T05:24:32.813119-06:00","closed_at":"2025-12-26T05:24:32.813119-06:00","close_reason":"Closed"}
{"id":"matchina-0vb","title":"HSM flatten-based docs update","description":"Update hierarchical-machines.mdx guide to focus on flatten-based approach.\\n\\nCurrent guide covers both flatten and propagate. Update to:\\n1. Lead with flatten approach as primary\\n2. Add flatten-based examples\\n3. Move propagation to 'advanced' or separate section\\n\\nDepends on: matchina-b96 (examples spike)","notes":"Depends on matchina-b96 (examples spike)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-26T06:56:34.46363-06:00","updated_at":"2025-12-26T07:21:52.73075-06:00","closed_at":"2025-12-26T07:21:52.73075-06:00","close_reason":"Guide already leads with flatten approach. Added link to interactive example."}
{"id":"matchina-0xj","title":"Fix flattened machine child.exit behavior to match nested semantics","description":"Flattened machines don't automatically trigger child.exit when reaching final child states like nested machines do. Implement effects-based solution to detect final child states (via change.to.data?.final) and automatically trigger child.exit transitions. This depends on implementing the parent transition fallback hook first to ensure flattened machines have clean separation between parent and child transitions.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:02:34.704398-06:00","updated_at":"2025-12-27T08:15:49.377602-06:00","closed_at":"2025-12-27T08:15:49.377602-06:00","close_reason":"Closed","comments":[{"id":4,"issue_id":"matchina-0xj","author":"winston","text":"Depends on matchina-iur - need parent transition fallback hook implemented first to ensure clean separation between parent and child transitions before implementing child.exit behavior.","created_at":"2025-12-27T14:02:41Z"}]}
{"id":"matchina-12s","title":"Mermaid visualizer broken - shows Loading forever","description":"Mermaid diagram tab never renders, stays on Loading state. Captured in visual review screenshots. Blocks full visualizer functionality.","notes":"Added error handling to Mermaid.tsx - now shows error instead of Loading forever. Root cause is Vite dev server dynamic import caching issue with mermaid's lazy-loaded diagram types. Error: 'Failed to fetch dynamically imported module: stateDiagram-v2-*.js'. Workaround: restart dev server to clear Vite cache.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T19:19:37.161233-06:00","updated_at":"2025-12-27T06:57:24.087323-06:00","closed_at":"2025-12-27T06:57:24.087328-06:00"}
{"id":"matchina-1ar","title":"feat/hsm-propagation: Event propagation / child-first routing (optional)","description":"Event propagation / child-first routing. Useful, but not required for hierarchy support if flattening is the primary mechanism.\n\nFiles:\n- src/nesting/propagateSubmachines.ts (new)\n- src/nesting/submachine.ts (new)\n- src/nesting/types.ts (new)\n- src/nesting/readHierarchicalFullKey.ts (new)\n- src/index.ts (exports)\n- test/hsm.*.ts (all HSM tests)\n- test/propagateSubmachines.bubble.test.ts\n\nDependencies: feat/hsm-definition-format, feat/machine-branding, feat/send-hook\nPriority: Phase 3 (optional)\nBranch: feat/hsm-propagation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:55:12.090983-06:00","updated_at":"2025-12-26T06:25:57.545384-06:00","closed_at":"2025-12-26T06:25:57.545384-06:00","close_reason":"Closed"}
{"id":"matchina-1av","title":"Review: Evaluate examples for consistency and library usage","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T06:53:24.276481-06:00","updated_at":"2025-12-22T07:01:20.804509-06:00","closed_at":"2025-12-22T07:01:20.804509-06:00","close_reason":"Completed examples review - checkout clean, searchbar overcomplicated, nested-vs-flattened useful for docs"}
{"id":"matchina-1r3","title":"Make Mermaid flowchart viz support nesting","description":"Mermaid state chart shows nested machines but flowchart version does not.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-22T06:36:23.120013-06:00","updated_at":"2025-12-22T06:38:52.884144-06:00","closed_at":"2025-12-22T06:38:52.884144-06:00","close_reason":"Added recursive nesting support to toStateDiagram using subgraphs"}
{"id":"matchina-1ve","title":"Docs: Add StoreMachine guide and interactive example","description":"StoreMachine is a major feature but lacks:\\n- Dedicated guide page in docs/src/content/docs/guides/\\n- Interactive example in docs/src/code/examples/\\n- Comparison with FactoryMachine (when to use which)\\nRef: review/05-docs.md, review/06-demo.md","notes":"Blocker removed - HSM now in stacked branches. Independent docs work.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-25T12:18:11.152582-06:00","updated_at":"2025-12-26T07:53:15.736386-06:00","closed_at":"2025-12-26T07:53:15.736386-06:00","close_reason":"Closed","dependencies":[{"issue_id":"matchina-1ve","depends_on_id":"matchina-aj9","type":"blocks","created_at":"2025-12-25T18:51:53.607138-06:00","created_by":"daemon"}]}
{"id":"matchina-22j","title":"Write comprehensive code review document HIERARCHICAL_MACHINES_R4_CODE_REVIEW.md","status":"closed","issue_type":"task","created_at":"2025-12-22T06:53:25.042595-06:00","updated_at":"2025-12-22T07:01:30.385632-06:00","closed_at":"2025-12-22T07:01:30.385632-06:00","close_reason":"Review document complete: HIERARCHICAL_MACHINES_R4_CODE_REVIEW.md with full analysis, findings, and recommendations","dependencies":[{"issue_id":"matchina-22j","depends_on_id":"matchina-64z","type":"blocks","created_at":"2025-12-22T06:53:37.351285-06:00","created_by":"daemon"},{"issue_id":"matchina-22j","depends_on_id":"matchina-tjx","type":"blocks","created_at":"2025-12-22T06:53:37.484731-06:00","created_by":"daemon"},{"issue_id":"matchina-22j","depends_on_id":"matchina-1av","type":"blocks","created_at":"2025-12-22T06:53:37.62052-06:00","created_by":"daemon"},{"issue_id":"matchina-22j","depends_on_id":"matchina-df4","type":"blocks","created_at":"2025-12-22T06:53:37.73589-06:00","created_by":"daemon"},{"issue_id":"matchina-22j","depends_on_id":"matchina-hd1","type":"blocks","created_at":"2025-12-22T06:53:37.85162-06:00","created_by":"daemon"}]}
{"id":"matchina-2c5","title":"Create withEventApi extension function","description":"Refactor assignEventApi to work with .extend() pattern.\\n\\nCurrent: assignEventApi(machine) returns machine with event methods\\nNew: withEventApi as extension function for .extend()\\n\\nUsage:\\n  createMachine(...).extend(withEventApi)\\n\\nBlocked by: matchina-dx0 (.extend() implementation)\\nRef: review/94-api-brainstorm.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T18:23:06.88957-06:00","updated_at":"2025-12-25T18:40:54.549216-06:00","closed_at":"2025-12-25T18:40:54.549216-06:00","close_reason":"Closed","dependencies":[{"issue_id":"matchina-2c5","depends_on_id":"matchina-aj9","type":"blocks","created_at":"2025-12-25T18:51:50.15922-06:00","created_by":"daemon"}]}
{"id":"matchina-2id","title":"ARCH: Unified Machine Structure Interface (flat/nested/general)","description":"Design a unified way to describe the structure/shape of ANY state machine - whether simple, nested, or flattened - that works for visualization and introspection.\n\nThe library is for general state machines. Visualization needs to work for all of them.\n\nCURRENT STATE:\n- Simple/nested machines: Work fine with runtime introspection\n- Flattened machines: Need external structure metadata\n- Visualization: Two separate code paths (one per model)\n\nGOAL:\nDefine a unified interface that describes the SHAPE/STRUCTURE of any machine, allowing visualization to be model-agnostic while still supporting all machine types.\n\nKEY CONSTRAINT:\nThis is NOT about templates or schemas. We're describing the runtime structure - how to visualize, navigate, and understand what's in a machine. The user prefers terminology like: manifest, info, flow, source, map, or shape.\n\nCHALLENGE:\nSimple machines need one representation. Nested machines (with submachines) need another. Flattened machines need a third. How do we unify without losing information about each approach?\n\nThe real question: What is the MINIMAL, UNIFIED interface that lets visualization work for all three?","design":"DESIGN REFINED: Static Shape Store Pattern\n\nCORE INSIGHT:\nShapes are MOSTLY static, compiled at definition-time. Only nested machines can have dynamic shape changes (when submachines are swapped/added).\n\nNEW APPROACH - Optional Shape Store Machine:\n\n1. SHAPE INTERFACE (static data structure):\n   interface MachineShape {\n     readonly states: ReadonlyMap\u003cstring, StateNode\u003e;\n     readonly transitions: ReadonlyMap\u003cstring, ReadonlyMap\u003cstring, string\u003e\u003e;\n     readonly hierarchy: ReadonlyMap\u003cstring, string | undefined\u003e;\n     readonly initialKey: string;\n     readonly type?: 'nested' | 'flattened';  // optional metadata\n   }\n\n2. SHAPE CONTROLLER (store machine):\n   interface ShapeController {\n     getState(): MachineShape;  // current compiled shape\n     subscribe(callback): () =\u003e void;  // listen for shape changes\n     // standard store machine API\n   }\n\n3. MACHINE INTEGRATION:\n   - Optional property: machine.shape?: ShapeController\n   - Simple machines: no shape property (or optional empty shape)\n   - Flattened machines: static shape (locked at creation, never changes)\n   - Nested machines: dynamic shape (transitions when child.change events occur)\n\n4. VISUALIZATION PATTERN:\n   const shape = machine.shape?.getState();  // current structure\n   machine.shape?.subscribe((newShape) =\u003e {  // react to changes\n     // rebuild tree with new shape\n   });\n\n5. HIERARCHICAL CHANGE DETECTION:\n   - Hooks into existing propagateSubmachines/child.change mechanism\n   - On child.change (hierarchy mutation), shape store transitions\n   - Visualization automatically re-renders via store subscription\n\nBENEFITS:\n- Static shapes compiled once (not recomputed on every query)\n- Follows existing store/subscription patterns in codebase\n- Nested machines can evolve independently\n- Clear separation: shape data vs shape observation\n- Type-safe via store machine interface\n\nNEXT STEP: Implement shape builders for flattened and nested machines","notes":"DESIGN COMPLETE - READY FOR IMPLEMENTATION\n\nDesign doc: review/HSM_INSPECTION_PROTOCOL_DESIGN.md\n\nKey decisions:\n- Shapes are static data structures (maps), computed once at definition-time\n- Optional machine.shape property holds a ShapeController (store machine)\n- Flattened: static shape, never changes\n- Nested: dynamic shape, recomputes on child.change events\n- Simple machines: no shape property (not hierarchical)\n\nIMPLEMENTATION TASK: matchina-03v\nThis ticket should NOT close until implementation is complete with no open bugs.","status":"in_progress","issue_type":"task","created_at":"2025-12-27T09:08:33.015858-06:00","updated_at":"2025-12-27T09:33:40.698221-06:00"}
{"id":"matchina-2yn","title":"Fix doc links created in this branch","description":"Fix any doc links broken by changes in this branch only.\n\nTasks:\n- Identify links broken by HSM changes\n- Fix only those affected by this branch\n\nAcceptance:\n- No broken links from branch changes\n- Other broken links deferred to post-merge\n\nPriority: could-do (not blocking merge)","notes":"Reviewed git diff. No doc links were broken by changes in this branch. All new files (hsm.ts, review docs) are self-contained. No action needed.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T16:19:41.281202-06:00","updated_at":"2025-12-25T16:36:34.447657-06:00","closed_at":"2025-12-25T16:36:34.447664-06:00"}
{"id":"matchina-3sj","title":"Create matchina/inspect subpath","description":"Move inspection utilities to matchina/inspect subpath.\\n\\nIncludes:\\n- getManifest() for machine introspection\\n- inspect(), getFullKey(), getDepth(), getStack() from nesting/inspect.ts\\n- XState-compatible manifest format\\n\\nBlocked by: HSM branch merge to main\\nRef: review/96-visualizers.md, review/101-work-plan.md","notes":"inspect.ts exists in feat/hsm-inspect-core branch. This task is about creating a matchina/inspect subpath export in package.json and index file. Can be done after HSM branches merge.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T18:22:45.785147-06:00","updated_at":"2025-12-26T07:17:32.972131-06:00","closed_at":"2025-12-26T07:17:32.972131-06:00","close_reason":"Added ./inspect subpath export to package.json pointing to dist/nesting/index","dependencies":[{"issue_id":"matchina-3sj","depends_on_id":"matchina-aj9","type":"blocks","created_at":"2025-12-25T18:51:51.477838-06:00","created_by":"daemon"}]}
{"id":"matchina-4ms","title":"feat/hsm-inspect-core: HSM inspection utilities (externalizable)","description":"Keep inspection as propagation-independent as possible: prefer operating on definitions and/or current state shape.\n\nFiles:\n- src/nesting/inspect.ts (new)\n- test/context-propagation-bug.test.ts\n- test/context-propagation-bug.test.tsx\n- test/debug-context-propagation.test.tsx\n\nDependencies: feat/hsm-definition-format\nPriority: Phase 2 (HSM definition-first)\nBranch: feat/hsm-inspect-core","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:54:53.310969-06:00","updated_at":"2025-12-26T06:30:26.646567-06:00","closed_at":"2025-12-26T06:30:26.646567-06:00","close_reason":"Closed"}
{"id":"matchina-4wx","title":"Dark mode contrast and color issues in visualizers","description":"Visual review found multiple dark mode UX issues:\n- Inactive visualizer tab stays WHITE (jarring glare)\n- Nested state boxes use white backgrounds (doesn't adapt)\n- Transition button text has low contrast on active state purple\n- State container boundaries hard to distinguish (dark-on-dark)\n\nGoal: Clean, readable visualizers in dark mode with proper contrast.","notes":"Replaced blue/purple accent with green (#166534) for active states. Fixed white text contrast. Updated visualizer tabs to neutral grays. Fixed transitions inside active state with inverted colors.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T19:19:37.360429-06:00","updated_at":"2025-12-26T19:57:25.961814-06:00","closed_at":"2025-12-26T19:25:22.213742-06:00","close_reason":"Closed"}
{"id":"matchina-5bo","title":"Fix authorize screen button overflow and non-clickable tabs","description":"In the checkout authorize payment screen, buttons are overflowing and not visible. The tab bar metaphor doesn't work because tabs aren't clickable. Need better UI with proper title and button wrapping.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-26T12:45:48.157923-06:00","updated_at":"2025-12-26T12:47:29.685731-06:00","closed_at":"2025-12-26T12:47:29.685731-06:00","close_reason":"Closed"}
{"id":"matchina-5lq","title":"Fix sidebar titles: change 'HSM' to 'Hierarchical' in examples","description":"The sidebar shows 'HSM Traffic Light', 'HSM Combobox', 'HSM Checkout' but should show 'Hierarchical Traffic Light', etc. for consistency with user preference.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-26T12:45:42.387849-06:00","updated_at":"2025-12-26T12:47:29.679042-06:00","closed_at":"2025-12-26T12:47:29.679042-06:00","close_reason":"Closed"}
{"id":"matchina-63u","title":"Nested hierarchical checkout lost hierarchy in diagrams","description":"Something has been lost from feature/hsm-with-viz where we figured out the nested/propagate impl. On the plus side the flattened checkout shows correct hierarchy in viz.\npeer example of flattened/nested traffic light DOES show hierarchy correctly in viz for both versions.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T13:17:46.200498-06:00","updated_at":"2025-12-26T13:31:31.383825-06:00","closed_at":"2025-12-26T13:31:31.383825-06:00","close_reason":"Closed"}
{"id":"matchina-64z","title":"Review: Identify all hierarchical machine implementation files","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T06:53:23.842184-06:00","updated_at":"2025-12-22T06:55:19.398467-06:00","closed_at":"2025-12-22T06:55:19.398467-06:00","close_reason":"Cataloged all HSM implementation files in /tmp/hsm-implementation-files.md"}
{"id":"matchina-678","title":"API: Export HSM APIs from main package","description":"HSM APIs not properly exported, forcing demos to use deep imports:\\n- submachine (src/nesting/submachine.ts)\\n- defineMachine (src/definitions.ts)\\n- createHierarchicalMachine (src/nesting/propagateSubmachines.ts)\\n- defineSubmachine (src/definitions.ts)\\n- flattenMachineDefinition (src/definitions.ts)\\n\\nEither export from 'matchina' or create 'matchina/hsm' subpath.\\nRef: review/06-demo.md, review/02-api-surface.md","notes":"Completed in this branch. HSM APIs exported from matchina/hsm subpath.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-25T12:18:05.173175-06:00","updated_at":"2025-12-25T16:36:43.460025-06:00","closed_at":"2025-12-25T16:36:43.460032-06:00"}
{"id":"matchina-6da","title":"Implement unified HSM visualization for hierarchical and flattened machines","description":"Implement the unified HSM visualization approach designed in matchina-jt7.\n\nImplementation tasks:\n1. Update inspection layer (getXStateDefinition) to handle both approaches consistently\n2. Fix SketchInspector state matching logic for flattened keys\n3. Update CSS styling to work properly for both hierarchical and flattened structures\n4. Ensure proper highlighting of active states in flattened HSMs\n5. Test both hierarchical and flattened checkout examples\n\nDesign notes (from matchina-jt7):\n- [Design will be populated here after matchina-jt7 is completed]\n\nDependencies:\n- Requires design completion from matchina-jt7\n- Requires analysis completion from matchina-qr8\n\nTesting:\n- Verify hierarchical HSM visualization still works\n- Verify flattened HSM visualization now works correctly\n- Test both light and dark themes\n- Test multiple nesting levels","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T07:30:07.384354-06:00","updated_at":"2025-12-27T07:34:41.915153-06:00","closed_at":"2025-12-27T07:34:41.915153-06:00","close_reason":"Closed"}
{"id":"matchina-6dt","title":"DEBUG: Flattened HSM checkout example visualization and runtime failures","description":"The HSM checkout example at localhost:4321/matchina/examples/hsm-checkout shows two related failures:\n\n1. VISUALIZATION BUG: SketchInspector shows parent transitions (back, exit, child.exit) copied down to child states in flattened mode. This is incorrect - flattened machines should show the actual state structure.\n\n2. RUNTIME BUG: Payment flow doesn't auto-transition to Review when reaching Payment.Authorized. Instead stays at Payment.Authorized. The expected flow is: Payment.Authorized -\u003e [automatic child.exit sent] -\u003e Review.\n\nBoth issues likely stem from incomplete integration of withFlattenedChildExit hook into createMachineFromFlat.","design":"REVISED ANALYSIS - ELEGANT APPROACH:\n\nPROBLEM WITH NAIVE FIX:\n- Using mutation + patching is not elegant for a library with hooks\n- updateTransitions mutates hierarchicalDef AFTER it's built with parent transitions\n- This is defensive patching, not structural design\n\nELEGANT ARCHITECTURAL FIX:\nFor visualization, the root issue is in buildDefinitionFromOriginal:\n- Lines 281-295 copy parent transitions to child states unconditionally\n- This is correct for nested machines (parent events DO bubble)\n- This is WRONG for flattened machines (parent transitions separate by design)\n\nSMART SOLUTION (no mutation, hook-aware):\nIn buildDefinitionFromFlattened, we should:\n1. NOT call buildDefinitionFromOriginal directly\n2. Instead: buildDefinitionFromOriginal should accept a parameter: copyParentTransitions: boolean\n3. Pass copyParentTransitions=false for flattened machines\n4. This way the definition is built correctly from the start, not patched later\n\nOR even more elegant:\n- Extract the parent-transition-copying logic (lines 281-295) into a separate function\n- Call it conditionally only for nested machines\n- For flattened machines, skip it entirely\n\nThis way:\n- No mutation after the fact\n- Clear intent in the code\n- Respects the architectural distinction between nested vs flattened\n- Aligns with the library's hook-based philosophy\n\nFIX #1 (Visualization - proper structural approach):\n- Add isFlattened parameter to buildDefinitionFromOriginal\n- Pass false for flattened machines\n- Skip parent-transition-copying logic when isFlattened=true\n- No mutation, intent is clear at build time\n\nFIX #2 (Runtime - unchanged):\n- Apply withFlattenedChildExit in createMachineFromFlat","acceptance_criteria":"- [ ] Payment.Authorized automatically triggers child.exit when reached\n- [ ] Review state is reached after Payment.Authorized (auto-exit flow completes)\n- [ ] SketchInspector no longer shows parent transitions on child states in flattened mode\n- [ ] Visualizer correctly shows child states with only their own transitions + child.exit\n- [ ] Both flat and nested checkout examples work identically from user perspective","notes":"COMPLETED with caveat: Fix works but revealed design conflict.\n\nWHAT WE FIXED:\n✅ Runtime auto-exit: withFlattenedChildExit now applies automatically\n✅ Visualization structure: Flattened machines no longer show false parent transitions\n✅ All tests passing\n✅ Example now works end-to-end\n\nWHAT WE REVEALED:\nThe visualization system has conflicting design patterns:\n- Flattened machines: Attach _originalDef to machine for visualization (metadata coupling)\n- Nested machines: Runtime introspection (no definition needed)\n\nThis creates maintenance burden and unclear conventions for future machine types.\n\nCreated ticket matchina-bbd to address underlying design conflict.\nRecommend reviewing visualization architecture before adding more machine types.\n\nThe fix itself is sound and elegant. The conflict is in the broader system design.","status":"closed","issue_type":"task","created_at":"2025-12-27T08:50:45.296206-06:00","updated_at":"2025-12-27T09:03:00.955003-06:00","closed_at":"2025-12-27T09:01:58.115896-06:00"}
{"id":"matchina-6eh","title":"Design: Decide between HSM Flattening vs Propagation","description":"Two competing HSM approaches exist without clear guidance:\\n1. Flattening (definitions.ts) - compile-time, produces dot-separated keys\\n2. Propagation (propagateSubmachines.ts) - runtime, preserves nested structure\\n\\nNeed to either:\\n- Pick one as primary and deprecate the other\\n- Clearly differentiate use cases in docs\\n- Document trade-offs (type inference, performance, debugging)\\nRef: review/01-architecture.md, review/90-synthesis.md","notes":"Completed in this branch. HSM APIs exported from matchina/hsm with flattening as primary and propagation as experimental escape hatch.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T12:18:19.717669-06:00","updated_at":"2025-12-25T16:35:58.521584-06:00","closed_at":"2025-12-25T16:35:58.521627-06:00","labels":["decision"]}
{"id":"matchina-6v3","title":"feat/send-hook: Add send hook to hook system","description":"Adds send hook, improves adapter types. Could depend on ext fixes but likely independent.\n\nFiles:\n- src/state-machine-hooks.ts (send hook, type improvements)\n- src/state-machine-hook-adapters.ts\n\nPriority: Phase 1 (atomic, no deps)\nBranch: feat/send-hook","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:54:29.248393-06:00","updated_at":"2025-12-26T06:26:07.777939-06:00","closed_at":"2025-12-26T06:26:07.777939-06:00","close_reason":"Closed"}
{"id":"matchina-7b4","title":"feat/visualizers: Visualization components (externalizable)","description":"Visualization components. Should depend only on inspection/definition-format outputs, not on propagation.\n\nFiles:\n- docs/src/components/inspectors/HSMMermaidInspector.tsx (new)\n- docs/src/components/inspectors/MermaidInspector.tsx (modified)\n- docs/src/components/inspectors/MermaidInspector.css (new)\n- docs/src/components/inspectors/SketchInspector.tsx (new)\n- docs/src/components/inspectors/SketchInspector.css (new)\n- docs/src/components/HSMVisualizerDemo.tsx (new)\n- docs/src/components/MachineExampleWithChart.tsx\n- docs/src/components/Mermaid.tsx\n- docs/src/components/mermaid.css\n- docs/src/code/examples/lib/matchina-machine-to-xstate-definition.ts\n- test/sketch-inspector*.test.tsx\n\nDependencies: feat/hsm-inspect-core\nPriority: Phase 2 (HSM definition-first)\nBranch: feat/visualizers","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:55:03.558298-06:00","updated_at":"2025-12-26T06:36:30.733677-06:00","closed_at":"2025-12-26T06:36:30.733677-06:00","close_reason":"Closed"}
{"id":"matchina-7ji","title":"flattened checkout example error enterinig payment","description":"clicking Proceed to Payment fails and logs\nmatchbox-factory.mjs:71 Uncaught Error: Match did not handle key: 'Payment.MethodEntry'\n    at MatchboxImpl.match (matchbox-factory.mjs:71:11)\n    at CheckoutControls (CheckoutView.tsx:220:14)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T06:58:37.230812-06:00","updated_at":"2025-12-27T06:59:14.242456-06:00","closed_at":"2025-12-27T06:59:14.24247-06:00"}
{"id":"matchina-7vj","title":"Flattened Combobox HSM diagram STYLING is not highlighting nested state well","description":"The whole point is to be an HSM but diagram is not showing nesting. After much research it seems to just be a styling issue. We need better styling on background of that nested thing. Should also have the green border, and the BGs on those should have a bit of transparency so that the shades vary across the levels.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T07:14:41.168623-06:00","updated_at":"2025-12-27T07:29:47.347167-06:00","closed_at":"2025-12-27T07:29:47.347167-06:00","close_reason":"Closed"}
{"id":"matchina-8mh","title":"fix/ext-types: Type fixes and import consolidation in ext/","description":"Type fixes and import consolidation in ext/. Independent.\n\nFiles:\n- src/ext/funcware/abortable.ts\n- src/ext/funcware/tap.ts\n- src/ext/methodware/enhance-method.ts\n- src/ext/methodware/method-enhancer.ts\n- src/ext/setup.ts (buildSetup addition)\n\nPriority: Phase 1 (atomic, no deps)\nBranch: fix/ext-types","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:54:26.824959-06:00","updated_at":"2025-12-26T05:13:35.522262-06:00","closed_at":"2025-12-26T05:13:35.522262-06:00","close_reason":"Closed"}
{"id":"matchina-8yh","title":"Implement flat versions and toggles for remaining HSM examples","description":"## What Was Done\n- Cleaned up HSM examples: removed redundant comparison directories (hsm-combobox-comparison, hsm-checkout-comparison, hsm-traffic-light-flat)\n- Renamed hsm-traffic-light-comparison to hsm-traffic-light with sticky toggle\n- Updated sidebar to remove 'Comparison' wording, simplified to 3 entries\n- Made toggle sticky below header bars with backdrop blur\n- Updated title to 'Hierarchical Traffic Light' for clarity\n\n## What Still Needs to Be Done\n- **hsm-combobox**: Create flat machine version (machine-flat.ts) and toggle UI in example.tsx\n- **hsm-checkout**: Create flat machine version (machine-flat.ts) and toggle UI in example.tsx  \n- **Visualizer consistency**: Ensure both examples use same visualizer pattern as traffic light (MachineExampleWithChart/VisualizerDemo)\n- **Remove redundant comparison tables**: Keep comparison table only in traffic light example unless different nuances exist\n- **Pattern consistency**: Match the traffic light example structure without redundancy\n- **Add to sidebar**: Once flat versions are implemented, add hsm-combobox and hsm-checkout back to sidebar\n\n## Technical Notes\n- Current hsm-combobox and hsm-checkout are unstaged and ready for implementation\n- Need to follow same pattern as hsm-traffic-light: flat vs nested toggle with sticky positioning\n- Visualizer should be consistent across all examples","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T12:24:17.281129-06:00","updated_at":"2025-12-26T12:26:45.518579-06:00","closed_at":"2025-12-26T12:26:45.518579-06:00","close_reason":"Closed"}
{"id":"matchina-9lt","title":"Widget styling - borders, spacing, z-index cleanup","description":"Combobox widget UX polish from visual review:\n- Input border too faint (contrast issue both modes)\n- Suggestions dropdown overlaps visualizer heading (z-index)\n- State label feels disconnected from input (spacing)\n\nKeep it simple - remove visual mess, ensure clean demo experience.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-26T19:19:37.563377-06:00","updated_at":"2025-12-26T21:00:10.952499-06:00","closed_at":"2025-12-26T21:00:10.952499-06:00","close_reason":"Closed"}
{"id":"matchina-9vg","title":"feat/hsm-flatten: Flatten nested definitions (core path)","description":"Flatten nested definitions into a single-level keyspace. This is the preferred HSM path and should remain independent of propagation.\n\nFiles:\n- src/definitions.ts (flattening exports live here today; may move later)\n- test/flatten.types.ts (new)\n\nDependencies: feat/hsm-definition-format\nPriority: Phase 2 (HSM definition-first)\nBranch: feat/hsm-flatten","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:54:49.734978-06:00","updated_at":"2025-12-26T06:00:14.333979-06:00","closed_at":"2025-12-26T06:00:14.333979-06:00","close_reason":"Closed"}
{"id":"matchina-9zh","title":"Externalize visualizers from docs","description":"Move visualization components from docs to separate package(s).\\n\\nCurrent location: docs/src/components/inspectors/\\n- StateChart (XState viz adapter)\\n- TreeView\\n- Timeline\\n- MachineExampleWithChart\\n\\nOptions:\\n- matchina/viz subpath\\n- Separate @matchina/viz package\\n- Keep in docs, document for copying\\n\\nBlocked by: matchina-p4g (manifest format design)\\nRef: review/96-visualizers.md","notes":"Lower priority - visualizers work well in docs. Externalizing can be done later if there's demand.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-25T18:23:00.110015-06:00","updated_at":"2025-12-26T07:21:11.440299-06:00","closed_at":"2025-12-26T07:21:11.440299-06:00","close_reason":"Visualizers work well in docs. No demand to externalize - defer indefinitely.","dependencies":[{"issue_id":"matchina-9zh","depends_on_id":"matchina-aj9","type":"blocks","created_at":"2025-12-25T18:51:56.070463-06:00","created_by":"daemon"}]}
{"id":"matchina-9zr","title":"feat/hsm-definition-format: Core xstate-ish machine definition format","description":"Core xstate-ish machine definition format (states, transitions, initial). This is the stable base that inspection/viz should target.\n\nFiles:\n- src/definitions.ts (new)\n- src/definition-types.ts (new)\n- test/definitions.test.ts (new)\n\nDependencies: fix/types\nPriority: Phase 2 (HSM definition-first)\nBranch: feat/hsm-definition-format","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:54:46.33799-06:00","updated_at":"2025-12-26T06:00:14.323838-06:00","closed_at":"2025-12-26T06:00:14.323838-06:00","close_reason":"Closed"}
{"id":"matchina-a8f","title":"feat/react-use-machine-maybe: Add useMachineMaybe hook","description":"Adds useMachineMaybe for optional machine support. Independent.\n\nFiles:\n- src/integrations/react.ts (useMachineMaybe, improved useMachine)\n\nPriority: Phase 1 (atomic, no deps)\nBranch: feat/react-use-machine-maybe","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:54:24.119645-06:00","updated_at":"2025-12-26T05:24:42.706505-06:00","closed_at":"2025-12-26T05:24:42.706505-06:00","close_reason":"Closed"}
{"id":"matchina-a9w","title":"Flattened HSM Checkout example -- Viz loses nested state","description":"After entering payment, the diagrams are unable to match nested states for some reason. When state is Payment.MethodEntry the viz is not able to match it. There is a problem with how we are mapping things and states. We probably need to step back and think about how to do this well, possibly write about analysis and plan in notes on this ticket before fixing.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T07:11:34.541475-06:00","updated_at":"2025-12-27T07:15:00.49963-06:00","closed_at":"2025-12-27T07:15:00.49963-06:00","close_reason":"Closed"}
{"id":"matchina-aj9","title":"Merge branch to main","description":"Merge hierarchical-machines-with-viz-r5 to main after TypeSlayer analysis.\n\nBlocked by:\n- matchina-v38 (TypeSlayer analysis)","notes":"Marked with tag merge-ready-hsm-r5. Not merging yet - doing TypeSlayer analysis first on new branch.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T16:19:46.514082-06:00","updated_at":"2025-12-26T06:31:38.916119-06:00","closed_at":"2025-12-26T06:31:38.916119-06:00","close_reason":"Abandoned - using stacked branch approach instead of direct merge"}
{"id":"matchina-ayj","title":"Mark propagation experimental","description":"Add @experimental JSDoc to propagation APIs to signal flattening is primary.\n\nTasks:\n- Add @experimental JSDoc to propagateSubmachines\n- Add @experimental JSDoc to createHierarchicalMachine\n- Update any docs referencing propagation\n\nAcceptance:\n- IDE shows experimental warning\n- Docs clearly state flattening is primary approach\n\nBlocks: branch merge","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T16:18:24.014698-06:00","updated_at":"2025-12-25T16:21:32.598196-06:00","closed_at":"2025-12-25T16:21:32.598202-06:00"}
{"id":"matchina-b3z","title":"BUG: buildNestedShape returns empty states for hierarchical machines","description":"buildNestedShape is being called from createDynamicShapeStore but returns empty state maps.\n\nOBSERVATIONS:\n- createDynamicShapeStore calls buildNestedShape(root) at line 379 of propagateSubmachines.ts\n- The shape store is created correctly (getXStateDefinition finds it)\n- But shape.getState() returns { states: Map(0), transitions: Map(0), hierarchy: Map(0), initialKey: '', type: 'nested' }\n- This causes buildDefinitionFromShape to fail because there are no states to process\n\nHYPOTHESIS:\n- buildNestedShape walks the machine hierarchy to collect states\n- It might be called before the hierarchy is fully established in propagateSubmachines\n- Or it's walking the wrong machine reference\n\nNEXT STEPS:\n1. Add logging to buildNestedShape to see what transitions it finds\n2. Check if root.transitions is populated when buildNestedShape is called\n3. Verify the machine has proper transitions object structure\n4. Check if hierarchical machines have flattened transitions or nested ones\n\nTEST FAILURES:\n- test/hsm-visualization-unified.test.ts: 3 tests fail when getXStateDefinition uses shape store\n  - Payment.states is undefined (no nested states found)\n  - Active.states is undefined (no nested states found)\n","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T09:42:07.995271-06:00","updated_at":"2025-12-27T09:51:58.000099-06:00","closed_at":"2025-12-27T09:51:58.000099-06:00","close_reason":"Closed"}
{"id":"matchina-b96","title":"HSM flatten-based examples spike","description":"Port HSM examples from feature/hsm-with-viz and adapt them to work with flattened machine definitions (no propagation required).\\n\\nExamples to port:\\n- hsm-checkout\\n- hsm-combobox\\n- hsm-nested-vs-flattened\\n\\nApproach: Use flattenMachineDefinition + createMachineFromFlat instead of propagateSubmachines.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-26T06:56:27.695972-06:00","updated_at":"2025-12-26T07:00:47.398411-06:00","closed_at":"2025-12-26T07:00:47.398411-06:00","close_reason":"Closed"}
{"id":"matchina-bbd","title":"DESIGN: Conflicting approaches to visualization definitions (nested vs flattened)","description":"The visualization system has two conflicting approaches:\n\nAPPROACH 1 - Flattened Machines (Static Definition):\n- Attaches _originalDef to the machine object (runtime data + metadata coupling)\n- Uses buildDefinitionFromFlattened which relies on this attached definition\n- Preserves hierarchical structure for visualization purposes\n\nAPPROACH 2 - Nested Machines (Runtime Introspection):\n- No definition attached to machine\n- Uses buildDefinition which introspects machine.states and machine.transitions at visualization time\n- Walks nested machines via state.data.machine references\n\nCONFLICTS:\n1. Separation of Concerns: _originalDef is a visualization concern coupled to runtime machines\n2. Consistency: Why do flattened machines preserve definition but nested don't?\n3. Submachine Handling: Nested machines discover submachines via introspection AND via machineFactory.def - two separate mechanisms\n4. Scalability: Introspection requires instantiating machines; static definitions avoid this\n5. Maintenance: Adding visualization features requires changes to machine creation, not just visualization code\n\nDESIGN QUESTIONS:\n- Should _originalDef be public API or internal implementation detail?\n- Should visualization system use static definitions or runtime introspection?\n- Should ALL machines preserve their definition for visualization? Or none?\n- Can visualization be fully separated from runtime machine concerns (via hooks)?\n- Should submachine discovery be unified (one mechanism, not two)?\n\nCURRENT STATE:\n- Works but has code smell of mixed concerns\n- Two different paths through getXStateDefinition create cognitive load\n- Unclear which approach is 'correct' for new machine types\n- Nested machines with submachines have complex introspection logic (lines 93-165)","notes":"DESIGN DECISION: DEFINITIONS ARE GONE\n\nShape store was supposed to be unified, but visualization still had definition fallback.\nThat experiment is dead. Removing ALL definition code.\n\nSOLUTION: Shape-only visualization\n- buildVisualizerTree() takes shape, returns tree for rendering\n- No introspection, no definitions, no fallbacks\n- Auto-attach shapes in matchina() when needed\n- matchina-edz will be fixed by this cleanup","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-27T09:02:56.603878-06:00","updated_at":"2025-12-27T10:07:11.060472-06:00"}
{"id":"matchina-bft","title":"BUG: Pre-existing flattening test expects parent transitions to be copied to children","description":"Test in test/definitions.test.ts expects that when a parent state has a transition, all leaf children inherit that transition.\n\nCurrent flattening logic comment says parent transitions should NOT be copied to children. But test expects them.\n\nThis is a pre-existing bug, not caused by shape store changes.\n\nDECISION FOR matchina-03v:\n- This is blocked by flattening logic, not shape stores  \n- Skip this test for now\n- Track as separate issue to fix before closing matchina-03v\n","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-27T09:42:16.267501-06:00","updated_at":"2025-12-27T09:51:58.015346-06:00","closed_at":"2025-12-27T09:51:58.015346-06:00","close_reason":"Closed"}
{"id":"matchina-ccb","title":"Combobox throws errors on click in both versions","description":"USED TO WORK ON BRANCH feature/hsm-with-viz\nand NEEDS TO WORK for flattened also. Use your head. \n\nUncaught Error: Match did not handle key: 'Active.Empty'\n    at MatchboxImpl.match (matchbox-factory.mjs:66:11)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T12:59:32.807975-06:00","updated_at":"2025-12-26T13:05:40.012871-06:00","closed_at":"2025-12-26T13:05:40.012871-06:00","close_reason":"Closed"}
{"id":"matchina-crt","title":"HSM visualization broken - state inspection not working across all scenarios","description":"After implementing unified HSM visualization approach, all visualizations (Sketch, Mermaid, ReactFlow) are no longer correctly identifying or displaying the current active state. This affects both hierarchical and flattened machines across all examples (combobox, checkout). The state highlighting and path detection is completely broken.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T07:37:29.836413-06:00","updated_at":"2025-12-27T07:42:13.998433-06:00","closed_at":"2025-12-27T07:42:13.998433-06:00","close_reason":"Closed","comments":[{"id":1,"issue_id":"matchina-crt","author":"winston","text":"Investigation findings: State detection logic (getActiveStatePath, getXStateDefinition) is working correctly in isolation. The issue appears to be in the visualizer components' use of this data. Reverted changes to HSMMermaidInspector, SketchInspector, and HSMVisualizerDemo to restore original functionality. Need to identify the specific breaking change in the unified approach.","created_at":"2025-12-27T13:39:20Z"},{"id":2,"issue_id":"matchina-crt","author":"winston","text":"SOLUTION: Reverted the unified visualization changes that broke state detection. The original implementations in HSMMermaidInspector, SketchInspector, and HSMVisualizerDemo are restored and working. The issue was that the unified approach replaced critical state detection logic with getActiveStatePath(), but this broke the visualizers' internal state matching. The getActiveStatePath() function works correctly in isolation but wasn't compatible with how the visualizers use the state data.","created_at":"2025-12-27T13:39:41Z"},{"id":3,"issue_id":"matchina-crt","author":"winston","text":"REMEDIATION COMPLETE: Fixed the state key naming inconsistency. \n\nKey changes made:\n1. Removed dead normalizeFullKeys() function from buildDefinitionFromFlattened()\n2. Kept dots in fullKey (e.g., 'Payment.MethodEntry') for consistency \n3. MermaidInspector handles dot-to-underscore conversion for node IDs\n4. Fixed 'any' types in CheckoutViewFlat/CheckoutViewNested interfaces to use proper FactoryMachine types\n\nThe state detection now works consistently: fullKey uses dots throughout, conversion to underscores happens only at the Mermaid diagram rendering layer.","created_at":"2025-12-27T13:42:09Z"}]}
{"id":"matchina-cuz","title":"Flattened child.exit needs earlier hook integration","description":"PARTIAL SUCCESS: Flattening fix worked - Authorized transitions are now empty as intended. BUT this reveals the real issue: child states need parent transitions to handle child.exit events. In flattened machines, Payment.Authorized has NO transitions, so child.exit cannot be processed. We need a different approach: either 1) Copy only child.exit transitions to children, or 2) Implement fallback logic that checks parent transitions when child has none.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:10:32.968156-06:00","updated_at":"2025-12-27T09:03:06.65122-06:00","closed_at":"2025-12-27T09:03:06.65122-06:00","close_reason":"Resolved by matchina-6dt: withFlattenedChildExit now applied automatically in createMachineFromFlat. Parent transitions accessible via fallback hook. Flattened machines now behave identically to nested machines for child.exit.","dependencies":[{"issue_id":"matchina-cuz","depends_on_id":"matchina-6dt","type":"related","created_at":"2025-12-27T08:50:47.355447-06:00","created_by":"daemon"}]}
{"id":"matchina-d38","title":"Examples are buried by AI Slop","description":"AI slop is pushing the examples down the page and it is repetitive slop because we don't need to repeat the same things on each example doc page.  \nWe need a better bar for substance over fluff when it comes to doc quality.\n","status":"open","priority":3,"issue_type":"bug","created_at":"2025-12-26T13:12:19.164516-06:00","updated_at":"2025-12-27T07:12:34.532553-06:00"}
{"id":"matchina-dco","title":"Mermaid vis seems to have lost clickable available actions","description":"in mermaid diagrams we generally want interactivity except where the machine/ui requires parameters be sent. i am not seeing this behavior in some of our diagrams. maybe we changed it to default to noninteractive. currently working on hierarchical examples for tag list editor and checkout flow, but would also like to add viz to the nested vs flattened examples, but all of those should allow interactivity in the diagram except where parameters are required, and even if they are there is probably a way to create a parameterless extension that handles that part.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-25T08:54:11.806514-06:00","updated_at":"2025-12-25T11:04:45.233561-06:00","closed_at":"2025-12-25T11:04:45.233561-06:00","close_reason":"Closed"}
{"id":"matchina-df4","title":"Review: Check documentation accuracy and completeness","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-22T06:53:24.46845-06:00","updated_at":"2025-12-22T07:01:46.265969-06:00","closed_at":"2025-12-22T07:01:46.265969-06:00","close_reason":"Documentation review deprioritized per user - focus was on core implementation quality"}
{"id":"matchina-dfp","title":"Review: Library Architecture Analysis and Planning","description":"Multi-prompt systematic review of matchina library. Prompts 0-9 covering structure, conceptual model, architecture, API surface, HSM semantics, types, docs, demo, synthesis, and task extraction.","notes":"Review complete. All strategic decisions made, documented in review/ folder.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T12:06:58.767443-06:00","updated_at":"2025-12-25T16:39:32.059597-06:00","closed_at":"2025-12-25T16:39:32.059609-06:00"}
{"id":"matchina-doc","title":"Flattened HSM child.exit fallback: parent transitions for child states","description":"Child states in flattened machines need to access parent state transitions.\n\nExample: Payment.Authorized has no transitions defined, but Payment parent has child.exit -\u003e Review. When in Payment.Authorized, sending child.exit should resolve to Review via parent fallback.\n\nThis enables flattened machines to properly support the child.exit pattern used in nested machines for exiting submachines.","notes":"COMPLETED: Implemented withParentTransitionFallback hook and integrated into createMachineFromFlat.\n\nIMPLEMENTATION:\n- src/nesting/parent-transition-fallback.ts: Hook using resolveExit middleware\n- src/definitions.ts: Integrated into createMachineFromFlat (automatic for all flattened machines)\n- test/test-flattened-child-exit-behavior.test.ts: Comprehensive tests - all passing\n\nKEY INSIGHTS:\n- Pattern: Use resolveExit hook (not send) for proper event resolution\n- Uses funcware/middleware pattern: (ev, next) =\u003e result\n- Falls back to parent only after normal resolution fails  \n- Properly handles multi-level hierarchies (Payment.Authorized -\u003e Payment)\n- FactoryMachineEventImpl used to create resolved events\n\nTESTS PASSING:\n- Manual child.exit from final child state works\n- Automatic child.exit (with withFlattenedChildExit) works  \n- Correct transition structure verified\n\nNEXT: Test flattened checkout UI to verify child.exit triggers correctly when reaching Payment.Authorized, then close issue.","status":"closed","issue_type":"feature","created_at":"2025-12-27T08:44:48.620945-06:00","updated_at":"2025-12-27T08:46:04.003566-06:00","closed_at":"2025-12-27T08:46:04.003573-06:00"}
{"id":"matchina-du2","title":"Fix checkout payment screen - empty body with footer buttons","description":"The checkout payment screen shows an empty body area but still displays footer buttons. The content area should show the payment child machine content properly.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-26T12:45:46.530429-06:00","updated_at":"2025-12-26T12:47:29.684519-06:00","closed_at":"2025-12-26T12:47:29.684519-06:00","close_reason":"Closed"}
{"id":"matchina-dx0","title":"Implement .extend() on FactoryMachine","description":"Add .extend\u003cT\u003e(fn: (m: Machine) =\u003e T): this \u0026 T method to FactoryMachine for composable extensions.\\n\\nThis enables:\\n- createMachine(...).extend(withEventApi)\\n- createMachine(...).extend(withSubscribe)\\n- Chaining: machine.extend(a).extend(b)\\n\\nBlocked by: HSM branch merge to main\\nRef: review/101-work-plan.md, review/94-api-brainstorm.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T18:22:37.149806-06:00","updated_at":"2025-12-25T18:40:53.298176-06:00","closed_at":"2025-12-25T18:40:53.298176-06:00","close_reason":"Closed","dependencies":[{"issue_id":"matchina-dx0","depends_on_id":"matchina-aj9","type":"blocks","created_at":"2025-12-25T18:51:19.92692-06:00","created_by":"daemon"}]}
{"id":"matchina-edz","title":"BUG: Flattened combobox viz shows flat list instead of hierarchy - no transitions","description":"When viewing hsm-combobox in flattened mode, SketchInspector shows flat list instead of hierarchy. No transitions visible. States shown as: Inactive, Active.Empty, Active.Typing, etc. Should show: Inactive, Active (parent with children: Empty, Typing, TextEntry, Suggesting).\n\nROOT CAUSE: combobox-flat.ts creates machine with matchina() directly, not createMachineFromFlat(), so no shape property. Falls back to runtime introspection via buildDefinition which doesn't parse dot-separated state keys into hierarchy.\n\nFIX: Either update buildDefinition to parse dots and build hierarchy, OR update combobox-flat.ts to use createMachineFromFlat.","notes":"ROOT CAUSE: Visualization fallback to buildDefinition() doesn't parse flat state keys\n\nThis bug reveals design flaw - definitions shouldn't exist.\n\nWILL BE FIXED BY: matchina-03v cleanup work\n- Delete buildDefinition() entirely\n- Make visualization shape-only\n- Auto-attach shape in matchina() when state keys have dots\n- combobox will automatically get proper hierarchy and transitions","status":"in_progress","issue_type":"bug","created_at":"2025-12-27T10:03:23.122718-06:00","updated_at":"2025-12-27T10:07:14.324166-06:00"}
{"id":"matchina-ei5","title":"nested combobox stopped working","description":"did work on original branch we ported it from.\ntyping causes\nUncaught TypeError: activeMachine?.typed is not a function","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T13:13:39.346865-06:00","updated_at":"2025-12-26T21:00:10.948569-06:00","closed_at":"2025-12-26T21:00:10.948569-06:00","close_reason":"Closed","dependencies":[{"issue_id":"matchina-ei5","depends_on_id":"matchina-4wx","type":"related","created_at":"2025-12-26T19:19:42.813116-06:00","created_by":"daemon"}]}
{"id":"matchina-eqn","title":"Nested machine visualizations should probably allow ancestor actions to be invoked","description":"ie while in payment, UI shows ability to go back, exit or child.exit, but in visualizer those are not clickable. they should be","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-25T08:50:29.349181-06:00","updated_at":"2025-12-25T11:03:44.482838-06:00","closed_at":"2025-12-25T11:03:44.482838-06:00","close_reason":"Closed"}
{"id":"matchina-f8e","title":"docs/readme-improvements: README link fixes and formatting","description":"Only the link fixes and non-HSM content. HSM docs go with HSM feature.\n\nFiles:\n- README.md (non-HSM portions: link fixes, formatting)\n\nPriority: Phase 1 (atomic, no deps)\nBranch: docs/readme-improvements","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:54:20.441834-06:00","updated_at":"2025-12-26T05:24:32.810296-06:00","closed_at":"2025-12-26T05:24:32.810296-06:00","close_reason":"Closed"}
{"id":"matchina-fhl","title":"Fix Tag List editor flattened version - machine.focus is not a function","description":"When using the flattened version of the Tag List editor, clicking 'Click to add tags' throws 'Uncaught TypeError: machine.focus is not a function' at ComboboxView.tsx:135:32. The hierarchical version works fine.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-26T12:45:44.363829-06:00","updated_at":"2025-12-26T12:47:29.683148-06:00","closed_at":"2025-12-26T12:47:29.683148-06:00","close_reason":"Closed"}
{"id":"matchina-fkw","title":"HSM packaging: Export from matchina/hsm","description":"Export flattening APIs from matchina/hsm subpath, mark propagation experimental.\n\nTasks:\n- Create/update matchina/hsm entry point\n- Export flattening APIs: flattenMachineDefinition, defineSubmachine, defineMachine\n- Export propagation APIs with experimental marker\n- Verify tree-shaking works\n\nAcceptance:\n- import { flattenMachineDefinition } from 'matchina/hsm' works\n- Propagation doesn't get bundled if not imported\n\nBlocks: branch merge","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T16:18:02.104911-06:00","updated_at":"2025-12-25T16:20:51.958958-06:00","closed_at":"2025-12-25T16:20:51.958967-06:00"}
{"id":"matchina-hd1","title":"Review: Catalog working docs for deletion/relocation","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T06:53:24.829879-06:00","updated_at":"2025-12-22T06:55:57.646805-06:00","closed_at":"2025-12-22T06:55:57.646805-06:00","close_reason":"Cataloged working docs in /tmp/working-docs-catalog.md - 16 files for immediate deletion, 8 for evaluation"}
{"id":"matchina-hi7","title":"Type system Phase 2: FlattenFactoryStateKeys optimization","description":"Optimize FlattenFactoryStateKeys template literal type.\\n\\nCurrent issue: ${string} suffix allows unbounded patterns, causing type explosion.\\n\\nProposed: Explicit union construction instead of template literal.\\n\\nBlocked by: HSM branch merge to main\\nRef: review/04-types.md (Phase 2 section)","notes":"HSM-specific type optimization. Should be worked on feat/hsm-flatten or later in the HSM stack, not on main.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-25T18:23:13.714382-06:00","updated_at":"2025-12-26T12:43:44.064131-06:00","closed_at":"2025-12-26T12:43:44.064135-06:00","dependencies":[{"issue_id":"matchina-hi7","depends_on_id":"matchina-aj9","type":"blocks","created_at":"2025-12-25T18:51:52.078543-06:00","created_by":"daemon"}]}
{"id":"matchina-iur","title":"Implement parent transition fallback hook for flattened machines","description":"Create a hook that catches unmatched transitions in flattened machines and tries parent states. When a transition is not found in the current dot-separated state (e.g., 'Payment.Authorized'), the hook should strip the last segment and try the parent state ('Payment'). This enables parent transitions to be available from child states without polluting child states with inherited transitions.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:02:31.59591-06:00","updated_at":"2025-12-27T08:09:08.51651-06:00","closed_at":"2025-12-27T08:09:08.51651-06:00","close_reason":"Closed"}
{"id":"matchina-jjx","title":"docs/hsm-propagation-examples: HSM propagation examples (optional)","description":"Higher-level examples that rely on propagation / child routing.\n\nFiles:\n- docs/src/content/docs/examples/hsm-checkout.mdx (new)\n- docs/src/content/docs/examples/hsm-combobox.mdx (new)\n- docs/src/code/examples/hsm-checkout/* (new)\n- docs/src/code/examples/hsm-combobox/* (new)\n\nDependencies: feat/hsm-propagation\nPriority: Phase 3 (optional)\nBranch: docs/hsm-propagation-examples","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:55:15.439191-06:00","updated_at":"2025-12-26T06:25:57.551257-06:00","closed_at":"2025-12-26T06:25:57.551257-06:00","close_reason":"Closed"}
{"id":"matchina-jt7","title":"Design unified HSM visualization approach for hierarchical and flattened machines","description":"Based on analysis from matchina-qr8, design a unified approach for HSM visualization that works consistently for both hierarchical and flattened machines.\n\nDesign requirements:\n1. Consistent state key matching regardless of HSM approach\n2. Proper visual hierarchy showing nesting/containment\n3. Correct highlighting of active states and ancestors\n4. Theme-compatible styling (light/dark)\n\nDesign considerations:\n- Should inspection layer normalize keys or should viz layer handle both?\n- How to map flattened keys (Payment.MethodEntry) to hierarchical structure\n- Whether to use dot notation universally or maintain approach-specific formats\n- How to handle state matching in SketchInspector for both approaches\n- CSS styling approach that works for both structures\n\nExpected deliverables:\n1. Clear design document with approach decision\n2. Specification of key format normalization (if needed)\n3. Updated inspection layer requirements\n4. Updated visualization layer requirements\n5. CSS styling approach that supports both\n\nThis design will be implemented in matchina-k3l.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T07:30:01.475568-06:00","updated_at":"2025-12-27T07:31:42.278648-06:00","closed_at":"2025-12-27T07:31:42.278648-06:00","close_reason":"Closed"}
{"id":"matchina-lc9","title":"TEST: Run full test suite to validate shape store changes","description":"After removing shape store creation from propagateSubmachines and fixing visualization layer to use runtime introspection for hierarchical machines, need to run full test suite to ensure no regressions.\n\nRun:\n  npm test\n\nFocus on verifying:\n- HSM tests (propagateSubmachines still works correctly)\n- Visualization tests (getXStateDefinition works for both flattened and hierarchical)\n- Flattened machine tests (static shapes still work)\n- No type errors in factory-machine-types.ts (shape property still optional)\n\nBlockers: None\nPriority: Critical-path (must complete before closing matchina-03v)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T09:49:08.959419-06:00","updated_at":"2025-12-27T09:51:58.010778-06:00","closed_at":"2025-12-27T09:51:58.010778-06:00","close_reason":"Closed"}
{"id":"matchina-mcg","title":"DO NOT SHARE VIEWs across DIFFERENT HSM types!!","description":"The two HSM types are incompatible because they use different state keys. It is BAD practice for our examples to try to handle both cases in one view. STOP doing this and FIX the places where we are doing this.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T07:09:00.263726-06:00","updated_at":"2025-12-27T07:35:30.284751-06:00","closed_at":"2025-12-27T07:35:30.284751-06:00","close_reason":"Closed"}
{"id":"matchina-ml8","title":"docs/hsm-flatten-guide: HSM documentation (flattening-first)","description":"Orient docs towards flattening first. Keep propagation as an optional section/follow-up.\n\nFiles:\n- docs/src/content/docs/guides/hierarchical-machines.mdx (new)\n- docs/src/content/docs/examples/hsm-overview.mdx (new)\n- docs/src/content/docs/examples/hsm-nested-vs-flattened.mdx (new)\n- docs/src/code/examples/hsm-nested-vs-flattened/* (new)\n- docs/astro.config.mjs (nav additions for HSM)\n- docs/src/content/docs/index.mdx (HSM links)\n- README.md (HSM section)\n\nDependencies: feat/hsm-definition-format, feat/hsm-flatten\nPriority: Phase 2 (HSM definition-first)\nBranch: docs/hsm-flatten-guide","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:54:58.338228-06:00","updated_at":"2025-12-26T06:00:14.339607-06:00","closed_at":"2025-12-26T06:00:14.339607-06:00","close_reason":"Closed"}
{"id":"matchina-nj2","title":"Docs: Fix 9 broken internal links","description":"Fix verified broken links in docs:\\n- traffic-light-extended.mdx: /matchina/guides/nested-states → /matchina/guides/hierarchical-machines\\n- traffic-light-extended.mdx: /matchina/guides/history (remove or create page)\\n- traffic-light.mdx, fetcher-advanced.mdx: /matchina/guides/matchbox-typescript-inference → /matchina/guides/machine-inference\\n- machines.mdx: Add /guides/ to paths for lifecycle, effects, promises, react, matchbox\\nRef: review/05-docs.md","notes":"Post-merge task. Not dependent on TypeSlayer.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-25T12:17:51.385277-06:00","updated_at":"2025-12-25T18:15:11.114124-06:00","closed_at":"2025-12-25T18:15:11.114124-06:00","close_reason":"Closed"}
{"id":"matchina-o6s","title":"feat/machine-branding: Runtime branding for type guards","description":"Runtime branding for type guards. Independent feature.\n\nFiles:\n- src/machine-brand.ts (new)\n- src/store-brand.ts (new)\n- src/is-machine.ts (new)\n- src/store-machine.ts (minor addition)\n- src/factory-machine.ts (branding call only)\n\nPriority: Phase 1 (atomic, no deps)\nBranch: feat/machine-branding","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:54:35.489646-06:00","updated_at":"2025-12-26T05:24:42.700124-06:00","closed_at":"2025-12-26T05:24:42.700124-06:00","close_reason":"Closed"}
{"id":"matchina-p4g","title":"Design manifest format for visualization","description":"Design XState-compatible MachineManifest interface for visualization.\\n\\nNeeds to expose:\\n- States (keys, data shape)\\n- Transitions (from, event, to)\\n- Initial state\\n- Hierarchy (for flattened/nested machines)\\n- Actions/effects (optional, for future)\\n\\nBlocked by: HSM branch merge to main\\nRef: review/96-visualizers.md, review/100-design-analysis.md","notes":"Lower priority - current getXStateDefinition format works well for visualization. Can formalize later if needed.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T18:22:52.534842-06:00","updated_at":"2025-12-26T07:21:10.552739-06:00","closed_at":"2025-12-26T07:21:10.552739-06:00","close_reason":"Current getXStateDefinition format with _originalDef preservation works well. No need to formalize further.","dependencies":[{"issue_id":"matchina-p4g","depends_on_id":"matchina-aj9","type":"blocks","created_at":"2025-12-25T18:51:50.868982-06:00","created_by":"daemon"}]}
{"id":"matchina-qcq","title":"Audit new type definitions for any usage","description":"Check definition-types.ts and related files created in this branch for any usage.\n\nTasks:\n- Check definition-types.ts for any usage\n- Check other type files added/modified in this branch\n- Document each instance and proposed fix\n- Create post-merge ticket with findings\n\nAcceptance:\n- List of any usages in new types only\n- Post-merge ticket created\n\nPriority: should-do (not blocking merge)","notes":"Found 20 'any' in definition-types.ts and 43 in definitions.ts. Most are in implementation code, but some in type definitions:\n\nType definitions with 'any':\n- MachineDefinition\u003cany, any, any\u003e (multiple places)\n- StateMatchboxFactory\u003cany\u003e (multiple places)\n- FactoryMachineTransitions\u003cF\u003e where F extends StateMatchboxFactory\u003cany\u003e\n- FlattenedStates\u003cS = any\u003e\n- FlattenedTransitions\u003cE extends string = string, To = any\u003e\n- FlatBuild: Record\u003cstring, any\u003e\n\nThese should be replaced with proper generics or 'unknown' in post-merge work.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T16:19:36.098438-06:00","updated_at":"2025-12-25T16:36:17.461786-06:00","closed_at":"2025-12-25T16:36:17.461794-06:00"}
{"id":"matchina-qr8","title":"Analyze HSM state key handling differences between hierarchical and flattened approaches","description":"The visualization layer is not properly handling state key matching between hierarchical and flattened HSM approaches. \n\nIn hierarchical HSMs:\n- State keys are simple (e.g., 'Payment')\n- Nested states are accessed via state.data.machine\n- Visualization walks the machine tree to build full paths\n\nIn flattened HSMs:\n- State keys include dots (e.g., 'Payment.MethodEntry')\n- No nested machine structure\n- Visualization needs to parse dot notation and match accordingly\n\nCurrent issues:\n1. SketchInspector state matching logic may not work correctly for flattened keys\n2. The inspection layer (getXStateDefinition) and visualization layer may have inconsistent key handling\n3. Styling assumes hierarchical structure but flattened machines have different structure\n\nNeed to analyze:\n- How state keys are generated and matched in each approach\n- How the inspection layer should normalize or handle both approaches\n- How the visualization layer should consistently render both approaches\n- Whether we need a unified abstraction or approach-specific handling","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T07:29:50.936373-06:00","updated_at":"2025-12-27T07:31:40.654479-06:00","closed_at":"2025-12-27T07:31:40.654479-06:00","close_reason":"Closed"}
{"id":"matchina-qtb","title":"Docs: Remove duplicate sections in README","description":"README.md has duplicate sections:\\n- 'Philosophy \u0026 Inspiration' appears twice (lines 13-24 and 20-24)\\n- 'What is Matchina?' appears twice (lines 2-11 and 26-28)\\n- 'Installation' appears twice (lines 54-58 and 674-678)\\nRef: review/05-docs.md","notes":"Post-merge task. Not dependent on TypeSlayer.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-25T12:17:58.185679-06:00","updated_at":"2025-12-25T18:13:46.86331-06:00","closed_at":"2025-12-25T18:13:46.86331-06:00","close_reason":"Closed"}
{"id":"matchina-r1d","title":"Deprecate matchina() function","description":"Add @deprecated JSDoc to matchina() pointing to createMachine().extend(withEventApi).\n\nTasks:\n- Add @deprecated JSDoc to matchina() function\n- Add deprecation message pointing to createMachine(...).extend(withEventApi)\n- Keep function working (no breaking change)\n\nAcceptance:\n- IDE shows deprecation warning\n- Function still works\n\nBlocks: branch merge","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T16:18:49.548435-06:00","updated_at":"2025-12-25T16:22:16.528316-06:00","closed_at":"2025-12-25T16:22:16.528328-06:00"}
{"id":"matchina-tah","title":"fix/docs-and-paths: Import path fixes and formatting","description":"Import path fixes, formatting, minor doc corrections. Independent.\n\nFiles:\n- docs/astro.config.mjs (formatting/path fixes only, NOT new nav items)\n- docs/src/code/examples/async-calculator/AsyncCalculatorView.tsx\n- docs/src/code/examples/stopwatch-using-react-state-using-transitionhooks/useStopwatch.ts\n- docs/src/code/examples/stopwatch/machine.ts\n- docs/src/code/examples/traffic-light-extended/TrafficLightView.tsx\n- docs/src/code/examples/usage-*.ts (multiple files)\n- docs/src/code/examples/lib/state-utils.ts\n- .gitattributes\n\nPriority: Phase 1 (atomic, no deps)\nBranch: fix/docs-and-paths","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:54:19.278196-06:00","updated_at":"2025-12-26T05:24:32.803968-06:00","closed_at":"2025-12-26T05:24:32.803968-06:00","close_reason":"Closed"}
{"id":"matchina-tjx","title":"Review: Analyze hierarchical machine tests for coverage and quality","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T06:53:24.063354-06:00","updated_at":"2025-12-22T06:59:09.147997-06:00","closed_at":"2025-12-22T06:59:09.147997-06:00","close_reason":"Completed test analysis - 23 tests, 2349 total lines, comprehensive coverage of propagation, stamping, child.exit"}
{"id":"matchina-uid","title":"chore/ai-setup: AI agent guidance + beads issue tracking","description":"Combine AI agent guidance + local issue tracking setup. Independent of all other changes.\n\nFiles:\n- AGENTS.md (new)\n- CLAUDE.md (new)\n- docs/AGENTS.md (modified)\n- .claude/settings.local.json (new)\n- .beads/* (new directory)\n\nPriority: Phase 1 (atomic, no deps)\nBranch: chore/ai-setup","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:54:12.475511-06:00","updated_at":"2025-12-26T05:07:10.809337-06:00","closed_at":"2025-12-26T05:07:10.809337-06:00","close_reason":"Closed"}
{"id":"matchina-ukb","title":"Type System Phase 2: Fix FactoryMachine type errors","description":"Fix pre-existing type errors in factory-machine.ts that are unrelated to extend functionality\n\nType errors encountered during extend implementation:\n1. Line 75: Conversion of machine object to Partial\u003cFactoryMachine\u003cFC\u003e\u003e - overlap issue with resolveExit types\n2. Line 108: Conversion of FactoryMachineEventImpl\u003cE\u003e to E - arbitrary type instantiation issue\n\nThese errors appear to be pre-existing issues in the core factory-machine.ts file, not caused by the extend implementation. They should be addressed to improve type safety and developer experience.\n\nPriority: Medium - These don't block functionality but should be fixed for better type safety","notes":"HSM-specific type errors related to extend functionality. Should be worked on the HSM stack, not on main.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-25T18:41:36.39543-06:00","updated_at":"2025-12-26T12:43:48.663005-06:00","closed_at":"2025-12-26T12:43:48.663008-06:00"}
{"id":"matchina-v38","title":"TypeSlayer analysis for type performance","description":"Run TypeSlayer to identify type bottlenecks in matchina.\n\nTasks:\n- Run TypeSlayer on matchina codebase\n- Identify specific type performance issues\n- Focus on complex mapped types (ExtractEventParams, FlattenFactoryStateKeys)\n- Document findings and proposed fixes\n\nBlocks: matchina-aj9 (merge to main)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T16:36:03.133615-06:00","updated_at":"2025-12-25T17:34:46.732283-06:00","closed_at":"2025-12-25T17:34:46.732283-06:00","close_reason":"Closed"}
{"id":"matchina-vwk","title":"chore/deps: Package dependency updates","description":"Dependency updates. Review what's actually needed vs HSM-specific.\n\nFiles:\n- package.json\n- package-lock.json\n\nPriority: Phase 1 (atomic, no deps)\nBranch: chore/deps","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:54:38.729458-06:00","updated_at":"2025-12-26T05:24:32.816099-06:00","closed_at":"2025-12-26T05:24:32.816099-06:00","close_reason":"Closed"}
{"id":"matchina-vzq","title":"Nested tick event not working in traffic light example","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-22T00:01:31.993729-06:00","updated_at":"2025-12-22T00:12:54.665645-06:00","closed_at":"2025-12-22T00:12:54.665645-06:00","close_reason":"Fixed: propagateSubmachines now creates a new change event when child transitions, enabling React's useSyncExternalStore to detect changes. Added FactoryMachineEventImpl import and modified child.change handler to call transition() with a self-transition event (same from/to state but new event object). All tests pass including new hsm.react-change-detection.test.ts that specifically verifies the fix."}
{"id":"matchina-yiv","title":"fix/types: Type improvements for factory machines","description":"Type improvements that fix existing issues. Independent of HSM.\n\nFiles:\n- src/factory-machine-types.ts (NormalizeParams, getState return type)\n- src/function-types.ts\n- src/state-types.ts\n\nPriority: Phase 1 (atomic, no deps)\nBranch: fix/types","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:54:22.600012-06:00","updated_at":"2025-12-26T05:13:17.552319-06:00","closed_at":"2025-12-26T05:13:17.552319-06:00","close_reason":"Closed"}
{"id":"matchina-z07","title":"HSM Checkout example page fails to load","description":"I would guess there is some corruption or bad syntax or both.\n\nThe character \"\u003e\" is not valid inside a JSX element\nhsm-checkout/CheckoutView.tsx:178:1\nOpen in editor\nimport React, { useContext } from \"react\";\nimport { useMachine } from \"matchina/react\";\nimport { parseFlatStateKey } from \"./machine-flat\";\n\n// Context to share the payment machine\nconst CheckoutContext = React.createContext\u003c{\n  machine: any;\n  paymentMachine?: any;\n}\u003e({ machine: null });\n\nfunction useCheckoutContext() {\n  return useContext(CheckoutContext);\n}\n\ninterface CheckoutViewProps {\n  machine: any;\n  mode: \"flat\" | \"nested\";\n}\n\nexport function CheckoutView({ machine, mode }: CheckoutViewProps) {\n  const change = useMachine(machine) as { to: { key: string; data?: any } };\n  const state = change.to;\n\n  // Normalize state based on mode\n  let parent: string;\n  let child: string | null = null;\n  let paymentMachine: any = null;\n\n  if (mode === \"flat\") {\n    const parsed = parseFlatStateKey(state.key);\n    parent = parsed.parent;\n    child = parsed.child;\n  } else {\n    // Nested/Propagating mode\n    parent = state.key;\n    // Check for nested machine in data\n    if (state.data \u0026\u0026 state.data.machine) {\n      paymentMachine = state.data.machine;\n      const childState = paymentMachine.getState();\n      if (childState) {\n        child = childState.key;\n      }\n    }\n  }\n\n  const contextValue = { machine, paymentMachine };\n\n  return (\n    \u003cCheckoutContext.Provider value={contextValue}\u003e\n      \u003cdiv className=\"max-w-2xl mx-auto bg-white dark:bg-gray-900 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-6\"\u003e\n        \u003ch3 className=\"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4\"\u003eCheckout Flow\u003c/h3\u003e\n        \n        \u003cdiv className=\"space-y-6\"\u003e\n          \u003cCheckoutSteps currentStep={parent} /\u003e\n          \u003cPaymentSection /\u003e\n          \u003cCheckoutControls /\u003e\n\n          \u003cdiv className=\"text-xs text-gray-500 dark:text-gray-400\"\u003e\n            State: \u003cspan className=\"font-mono bg-gray-100 dark:bg-gray-800 px-1 rounded\"\u003e\n              {child ? `${parent}.${child}` : parent}\n            \u003c/span\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n    \u003c/CheckoutContext.Provider\u003e\n  );\n}\n\nfunction CheckoutSteps({ currentStep }: { currentStep: string }) {\n  const steps = [\n    { key: \"Cart\", label: \"Cart\" },\n    { key: \"Shipping\", label: \"Shipping\" },\n    { key: \"Payment\", label: \"Payment\" },\n    { key: \"Review\", label: \"Review\" },\n    { key: \"Confirmation\", label: \"Confirmation\" },\n  ];\n\n  const currentIndex = steps.findIndex(step =\u003e step.key === currentStep);\n\n  return (\n    \u003cdiv className=\"flex items-center justify-between\"\u003e\n      {steps.map((step, index) =\u003e (\n        \u003cdiv key={step.key} className=\"flex items-center\"\u003e\n          \u003cdiv\n            className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${\n              index \u003c= currentIndex\n                ? \"bg-blue-500 text-white\"\n                : \"bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400\"\n            }`}\n          \u003e\n            {index + 1}\n          \u003c/div\u003e\n          \u003cspan className=\"ml-2 text-sm text-gray-600 dark:text-gray-400\"\u003e{step.label}\u003c/span\u003e\n          {index \u003c steps.length - 1 \u0026\u0026 (\n            \u003cdiv\n              className={`w-12 h-0.5 mx-2 ${\n                index \u003c currentIndex ? \"bg-blue-500\" : \"bg-gray-200 dark:bg-gray-700\"\n              }`}\n            /\u003e\n          )}\n        \u003c/div\u003e\n      ))}\n    \u003c/div\u003e\n  );\n}\n\nfunction PaymentSection() {\n  const { machine, paymentMachine } = useCheckoutContext();\n  const state = machine.getState();\n\n  return state.match({\n    Payment: () =\u003e \u003cPaymentFlow /\u003e,\n    _: () =\u003e null,\n  }, false);\n}\n\nfunction PaymentFlow() {\n  const { paymentMachine } = useCheckoutContext();\n  const state = paymentMachine?.getState();\n\n  if (!state) return null;\n\n  return (\n    \u003cdiv className=\"border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-gray-50 dark:bg-gray-800\"\u003e\n      \u003ch4 className=\"font-medium text-gray-900 dark:text-gray-100 mb-3\"\u003ePayment Method\u003c/h4\u003e\n      \n      \u003cdiv className=\"space-y-3\"\u003e\n        {state.match({\n          MethodEntry: () =\u003e (\n            \u003cdiv\u003e\n              \u003cp className=\"text-sm text-gray-600 dark:text-gray-400 mb-2\"\u003eSelect payment method\u003c/p\u003e\n              \u003cbutton\n                onClick={() =\u003e paymentMachine?.authorize?.()}\n                className=\"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600\"\n              \u003e\n                Authorize Payment\n              \u003c/button\u003e\n            \u003c/div\u003e\n          ),\n          Authorizing: () =\u003e (\n            \u003cdiv className=\"flex items-center space-x-2\"\u003e\n              \u003cdiv className=\"animate-spin w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full\" /\u003e\n              \u003cspan className=\"text-sm text-gray-600 dark:text-gray-400\"\u003eAuthorizing...\u003c/span\u003e\n            \u003c/div\u003e\n          ),\n          AuthChallenge: () =\u003e (\n            \u003cdiv\u003e\n              \u003cp className=\"text-sm text-gray-600 dark:text-gray-400 mb-2\"\u003eAdditional authentication required\u003c/p\u003e\n              \u003cdiv className=\"space-x-2\"\u003e\n                \u003cbutton\n                  onClick={() =\u003e paymentMachine?.authSucceeded?.()}\n                  className=\"px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600\"\n                \u003e\n                  Approve\n                \u003c/button\u003e\n                \u003cbutton\n                  onClick={() =\u003e paymentMachine?.authFailed?.()}\n                  className=\"px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600\"\n                \u003e\n                  Deny\n                \u003c/button\u003e\n              \u003c/div\u003e\n            \u003c/div\u003e\n          ),\n          AuthorizationError: () =\u003e (\n            \u003cdiv\u003e\n              \u003cp className=\"text-sm text-red-600 dark:text-red-400 mb-2\"\u003eAuthorization failed\u003c/p\u003e\n              \u003cbutton\n                onClick={() =\u003e paymentMachine?.retry?.()}\n                className=\"px-3 py. py- .bg-yellow .500 .white .rounded .hover:bg-yellow-600\"\n              \u003e\n                Retry\n              \u003c/button\u003e\n            \u003c/div\u003e\n          ),\n          Authorized: () =\u003e (\n            \u003cdiv className=\"flex items. .space .space-x 2 text .text-green .600 . .dark:text .400\"\u003e\n.\u003e\n^\n              .svg .className=\" .w- .5 .h .5 .fill .currentColor .viewBox .0 0 20 20.\u003e\n .path .fillRule .evenodd .d .M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z .clipRule .evenodd .\u003e\n .svg\u003e\n .span .className .text-sm .font-medium.\u003ePayment Authorized\u003c/span\u003e\n .div\u003e\n          ),\n        }, null)}\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );","status":"closed","issue_type":"bug","created_at":"2025-12-26T13:01:33.711252-06:00","updated_at":"2025-12-26T13:05:40.005767-06:00","closed_at":"2025-12-26T13:05:40.005767-06:00","close_reason":"Closed"}
{"id":"matchina-zc0","title":"hsm flattened checkout example - error entering payment","description":"nested buttons work now.\nflattened breaks on proceed to payment\nmatchbox-factory.mjs:71 Uncaught Error: Match did not handle key: 'Payment.MethodEntry'\n    at MatchboxImpl.match (matchbox-factory.mjs:71:11)\n\nare we trying to make them use the same UI? would not be necessary. fix  flattened buttons","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T13:10:33.070618-06:00","updated_at":"2025-12-27T07:12:22.057469-06:00","closed_at":"2025-12-27T07:12:22.057473-06:00"}
