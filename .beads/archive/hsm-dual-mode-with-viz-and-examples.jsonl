# Archive of completed issues for feat/hsm-dual-mode-with-viz-and-examples branch
# Archived on $(date)
# These issues were completed as part of the HSM dual mode visualization and examples work
{"id":"matchina-52b","title":"Colors: Fix Mermaid visualizer dark mode contrast - accent colors","description":"Mermaid diagrams have poor contrast in dark mode with washed out lavender. Fix to use theme accent colors with proper WCAG AA contrast ratios (4.5:1 minimum).","design":"Replace hardcoded colors in MermaidInspector.css: use --sl-color-accent for active nodes, --sl-color-text-invert for text labels, --sl-color-gray-5 for inactive nodes. All text must meet WCAG AA standards.","status":"closed","issue_type":"feature","created_at":"2025-12-27T14:08:40.619755-06:00","updated_at":"2025-12-27T14:09:31.718843-06:00","closed_at":"2025-12-27T14:09:31.718843-06:00","close_reason":"Consolidating into grouped ticket","dependency_count":0,"dependent_count":0}
{"id":"matchina-ly1","title":"REGRESSION: Nested combobox diagram lost transitions","description":"Flattened combobox now shows transitions correctly, but nested/hierarchical combobox lost its transitions in the diagram. Need to check if buildHierarchicalShape needs similar fix or if this is a separate issue.","status":"closed","issue_type":"bug","created_at":"2025-12-27T12:08:16.070868-06:00","updated_at":"2025-12-27T12:09:51.290733-06:00","closed_at":"2025-12-27T12:09:51.290733-06:00","close_reason":"Applied same automatic transition discovery fix to buildHierarchicalShape. Both builders now consistently discover function-based transitions.","dependency_count":0,"dependent_count":0}
{"id":"matchina-edz","title":"BUG: Flattened combobox viz shows flat list instead of hierarchy - no transitions","description":"When viewing hsm-combobox in flattened mode, SketchInspector shows flat list instead of hierarchy. No transitions visible. States shown as: Inactive, Active.Empty, Active.Typing, etc. Should show: Inactive, Active (parent with children: Empty, Typing, TextEntry, Suggesting).\n\nROOT CAUSE: combobox-flat.ts creates machine with matchina() directly, not createMachineFromFlat(), so no shape property. Falls back to runtime introspection via buildDefinition which doesn't parse dot-separated state keys into hierarchy.\n\nFIX: Either update buildDefinition to parse dots and build hierarchy, OR update combobox-flat.ts to use createMachineFromFlat.","notes":"ROOT CAUSE: Visualization fallback to buildDefinition() doesn't parse flat state keys\n\nThis bug reveals design flaw - definitions shouldn't exist.\n\nWILL BE FIXED BY: matchina-03v cleanup work\n- Delete buildDefinition() entirely\n- Make visualization shape-only\n- Auto-attach shape in matchina() when state keys have dots\n- combobox will automatically get proper hierarchy and transitions","status":"closed","issue_type":"bug","created_at":"2025-12-27T10:03:23.122718-06:00","updated_at":"2025-12-27T10:27:04.632719-06:00","closed_at":"2025-12-27T10:27:04.632719-06:00","close_reason":"Shape-only visualization cleanup complete. Definitions removed, auto-attach working, combobox fixed. 143/143 tests pass.","dependency_count":0,"dependent_count":0}
{"id":"matchina-2id","title":"ARCH: Unified Machine Structure Interface (flat/nested/general)","description":"Design a unified way to describe the structure/shape of ANY state machine - whether simple, nested, or flattened - that works for visualization and introspection.\n\nThe library is for general state machines. Visualization needs to work for all of them.\n\nCURRENT STATE:\n- Simple/nested machines: Work fine with runtime introspection\n- Flattened machines: Need external structure metadata\n- Visualization: Two separate code paths (one per model)\n\nGOAL:\nDefine a unified interface that describes the SHAPE/STRUCTURE of any machine, allowing visualization to be model-agnostic while still supporting all machine types.\n\nKEY CONSTRAINT:\nThis is NOT about templates or schemas. We're describing the runtime structure - how to visualize, navigate, and understand what's in a machine. The user prefers terminology like: manifest, info, flow, source, map, or shape.\n\nCHALLENGE:\nSimple machines need one representation. Nested machines (with submachines) need another. Flattened machines need a third. How do we unify without losing information about each approach?\n\nThe real question: What is the MINIMAL, UNIFIED interface that lets visualization work for all three?","design":"DESIGN REFINED: Static Shape Store Pattern\n\nCORE INSIGHT:\nShapes are MOSTLY static, compiled at definition-time. Only nested machines can have dynamic shape changes (when submachines are swapped/added).\n\nNEW APPROACH - Optional Shape Store Machine:\n\n1. SHAPE INTERFACE (static data structure):\n   interface MachineShape {\n     readonly states: ReadonlyMap<string, StateNode>;\n     readonly transitions: ReadonlyMap<string, ReadonlyMap<string, string>>;\n     readonly hierarchy: ReadonlyMap<string, string | undefined>;\n     readonly initialKey: string;\n     readonly type?: 'nested' | 'flattened';  // optional metadata\n   }\n\n2. SHAPE CONTROLLER (store machine):\n   interface ShapeController {\n     getState(): MachineShape;  // current compiled shape\n     subscribe(callback): () => void;  // listen for shape changes\n     // standard store machine API\n   }\n\n3. MACHINE INTEGRATION:\n   - Optional property: machine.shape?: ShapeController\n   - Simple machines: no shape property (or optional empty shape)\n   - Flattened machines: static shape (locked at creation, never changes)\n   - Nested machines: dynamic shape (transitions when child.change events occur)\n\n4. VISUALIZATION PATTERN:\n   const shape = machine.shape?.getState();  // current structure\n   machine.shape?.subscribe((newShape) => {  // react to changes\n     // rebuild tree with new shape\n   });\n\n5. HIERARCHICAL CHANGE DETECTION:\n   - Hooks into existing propagateSubmachines/child.change mechanism\n   - On child.change (hierarchy mutation), shape store transitions\n   - Visualization automatically re-renders via store subscription\n\nBENEFITS:\n- Static shapes compiled once (not recomputed on every query)\n- Follows existing store/subscription patterns in codebase\n- Nested machines can evolve independently\n- Clear separation: shape data vs shape observation\n- Type-safe via store machine interface\n\nNEXT STEP: Implement shape builders for flattened and nested machines","notes":"DESIGN COMPLETE - READY FOR IMPLEMENTATION\n\nDesign doc: review/HSM_INSPECTION_PROTOCOL_DESIGN.md\n\nKey decisions:\n- Shapes are static data structures (maps), computed once at definition-time\n- Optional machine.shape property holds a ShapeController (store machine)\n- Flattened: static shape, never changes\n- Nested: dynamic shape, recomputes on child.change events\n- Simple machines: no shape property (not hierarchical)\n\nIMPLEMENTATION TASK: matchina-03v\nThis ticket should NOT close until implementation is complete with no open bugs.","status":"closed","issue_type":"task","created_at":"2025-12-27T09:08:33.015858-06:00","updated_at":"2025-12-27T12:12:53.387656-06:00","closed_at":"2025-12-27T12:12:53.387656-06:00","close_reason":"Implementation complete. matchina-03v (shape store protocol) is done and all tests pass. Unified interface is working across flat/nested/simple machines.","dependency_count":0,"dependent_count":0}
{"id":"matchina-6dt","title":"DEBUG: Flattened HSM checkout example visualization and runtime failures","description":"The HSM checkout example at localhost:4321/matchina/examples/hsm-checkout shows two related failures:\n\n1. VISUALIZATION BUG: SketchInspector shows parent transitions (back, exit, child.exit) copied down to child states in flattened mode. This is incorrect - flattened machines should show the actual state structure.\n\n2. RUNTIME BUG: Payment flow doesn't auto-transition to Review when reaching Payment.Authorized. Instead stays at Payment.Authorized. The expected flow is: Payment.Authorized -> [automatic child.exit sent] -> Review.\n\nBoth issues likely stem from incomplete integration of withFlattenedChildExit hook into createMachineFromFlat.","design":"REVISED ANALYSIS - ELEGANT APPROACH:\n\nPROBLEM WITH NAIVE FIX:\n- Using mutation + patching is not elegant for a library with hooks\n- updateTransitions mutates hierarchicalDef AFTER it's built with parent transitions\n- This is defensive patching, not structural design\n\nELEGANT ARCHITECTURAL FIX:\nFor visualization, the root issue is in buildDefinitionFromOriginal:\n- Lines 281-295 copy parent transitions to child states unconditionally\n- This is correct for nested machines (parent events DO bubble)\n- This is WRONG for flattened machines (parent transitions separate by design)\n\nSMART SOLUTION (no mutation, hook-aware):\nIn buildDefinitionFromFlattened, we should:\n1. NOT call buildDefinitionFromOriginal directly\n2. Instead: buildDefinitionFromOriginal should accept a parameter: copyParentTransitions: boolean\n3. Pass copyParentTransitions=false for flattened machines\n4. This way the definition is built correctly from the start, not patched later\n\nOR even more elegant:\n- Extract the parent-transition-copying logic (lines 281-295) into a separate function\n- Call it conditionally only for nested machines\n- For flattened machines, skip it entirely\n\nThis way:\n- No mutation after the fact\n- Clear intent in the code\n- Respects the architectural distinction between nested vs flattened\n- Aligns with the library's hook-based philosophy\n\nFIX #1 (Visualization - proper structural approach):\n- Add isFlattened parameter to buildDefinitionFromOriginal\n- Pass false for flattened machines\n- Skip parent-transition-copying logic when isFlattened=true\n- No mutation, intent is clear at build time\n\nFIX #2 (Runtime - unchanged):\n- Apply withFlattenedChildExit in createMachineFromFlat","acceptance_criteria":"- [ ] Payment.Authorized automatically triggers child.exit when reached\n- [ ] Review state is reached after Payment.Authorized (auto-exit flow completes)\n- [ ] SketchInspector no longer shows parent transitions on child states in flattened mode\n- [ ] Visualizer correctly shows child states with only their own transitions + child.exit\n- [ ] Both flat and nested checkout examples work identically from user perspective","notes":"COMPLETED with caveat: Fix works but revealed design conflict.\n\nWHAT WE FIXED:\n✅ Runtime auto-exit: withFlattenedChildExit now applies automatically\n✅ Visualization structure: Flattened machines no longer show false parent transitions\n✅ All tests passing\n✅ Example now works end-to-end\n\nWHAT WE REVEALED:\nThe visualization system has conflicting design patterns:\n- Flattened machines: Attach _originalDef to machine for visualization (metadata coupling)\n- Nested machines: Runtime introspection (no definition needed)\n\nThis creates maintenance burden and unclear conventions for future machine types.\n\nCreated ticket matchina-bbd to address underlying design conflict.\nRecommend reviewing visualization architecture before adding more machine types.\n\nThe fix itself is sound and elegant. The conflict is in the broader system design.","status":"closed","issue_type":"task","created_at":"2025-12-27T08:50:45.296206-06:00","updated_at":"2025-12-27T09:03:00.955003-06:00","closed_at":"2025-12-27T09:01:58.115896-06:00","dependency_count":0,"dependent_count":1}
{"id":"matchina-doc","title":"Flattened HSM child.exit fallback: parent transitions for child states","description":"Child states in flattened machines need to access parent state transitions.\n\nExample: Payment.Authorized has no transitions defined, but Payment parent has child.exit -> Review. When in Payment.Authorized, sending child.exit should resolve to Review via parent fallback.\n\nThis enables flattened machines to properly support the child.exit pattern used in nested machines for exiting submachines.","notes":"COMPLETED: Implemented withParentTransitionFallback hook and integrated into createMachineFromFlat.\n\nIMPLEMENTATION:\n- src/nesting/parent-transition-fallback.ts: Hook using resolveExit middleware\n- src/definitions.ts: Integrated into createMachineFromFlat (automatic for all flattened machines)\n- test/test-flattened-child-exit-behavior.test.ts: Comprehensive tests - all passing\n\nKEY INSIGHTS:\n- Pattern: Use resolveExit hook (not send) for proper event resolution\n- Uses funcware/middleware pattern: (ev, next) => result\n- Falls back to parent only after normal resolution fails  \n- Properly handles multi-level hierarchies (Payment.Authorized -> Payment)\n- FactoryMachineEventImpl used to create resolved events\n\nTESTS PASSING:\n- Manual child.exit from final child state works\n- Automatic child.exit (with withFlattenedChildExit) works  \n- Correct transition structure verified\n\nNEXT: Test flattened checkout UI to verify child.exit triggers correctly when reaching Payment.Authorized, then close issue.","status":"closed","issue_type":"feature","created_at":"2025-12-27T08:44:48.620945-06:00","updated_at":"2025-12-27T08:46:04.003566-06:00","closed_at":"2025-12-27T08:46:04.003573-06:00","dependency_count":0,"dependent_count":0}
{"id":"matchina-z07","title":"HSM Checkout example page fails to load","description":"I would guess there is some corruption or bad syntax or both.\n\nThe character \">\" is not valid inside a JSX element\nhsm-checkout/CheckoutView.tsx:178:1\nOpen in editor\nimport React, { useContext } from \"react\";\nimport { useMachine } from \"matchina/react\";\nimport { parseFlatStateKey } from \"./machine-flat\";\n\n// Context to share the payment machine\nconst CheckoutContext = React.createContext<{\n  machine: any;\n  paymentMachine?: any;\n}>({ machine: null });\n\nfunction useCheckoutContext() {\n  return useContext(CheckoutContext);\n}\n\ninterface CheckoutViewProps {\n  machine: any;\n  mode: \"flat\" | \"nested\";\n}\n\nexport function CheckoutView({ machine, mode }: CheckoutViewProps) {\n  const change = useMachine(machine) as { to: { key: string; data?: any } };\n  const state = change.to;\n\n  // Normalize state based on mode\n  let parent: string;\n  let child: string | null = null;\n  let paymentMachine: any = null;\n\n  if (mode === \"flat\") {\n    const parsed = parseFlatStateKey(state.key);\n    parent = parsed.parent;\n    child = parsed.child;\n  } else {\n    // Nested/Propagating mode\n    parent = state.key;\n    // Check for nested machine in data\n    if (state.data && state.data.machine) {\n      paymentMachine = state.data.machine;\n      const childState = paymentMachine.getState();\n      if (childState) {\n        child = childState.key;\n      }\n    }\n  }\n\n  const contextValue = { machine, paymentMachine };\n\n  return (\n    <CheckoutContext.Provider value={contextValue}>\n      <div className=\"max-w-2xl mx-auto bg-white dark:bg-gray-900 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-6\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4\">Checkout Flow</h3>\n        \n        <div className=\"space-y-6\">\n          <CheckoutSteps currentStep={parent} />\n          <PaymentSection />\n          <CheckoutControls />\n\n          <div className=\"text-xs text-gray-500 dark:text-gray-400\">\n            State: <span className=\"font-mono bg-gray-100 dark:bg-gray-800 px-1 rounded\">\n              {child ? `${parent}.${child}` : parent}\n            </span>\n          </div>\n        </div>\n      </div>\n    </CheckoutContext.Provider>\n  );\n}\n\nfunction CheckoutSteps({ currentStep }: { currentStep: string }) {\n  const steps = [\n    { key: \"Cart\", label: \"Cart\" },\n    { key: \"Shipping\", label: \"Shipping\" },\n    { key: \"Payment\", label: \"Payment\" },\n    { key: \"Review\", label: \"Review\" },\n    { key: \"Confirmation\", label: \"Confirmation\" },\n  ];\n\n  const currentIndex = steps.findIndex(step => step.key === currentStep);\n\n  return (\n    <div className=\"flex items-center justify-between\">\n      {steps.map((step, index) => (\n        <div key={step.key} className=\"flex items-center\">\n          <div\n            className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${\n              index <= currentIndex\n                ? \"bg-blue-500 text-white\"\n                : \"bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400\"\n            }`}\n          >\n            {index + 1}\n          </div>\n          <span className=\"ml-2 text-sm text-gray-600 dark:text-gray-400\">{step.label}</span>\n          {index < steps.length - 1 && (\n            <div\n              className={`w-12 h-0.5 mx-2 ${\n                index < currentIndex ? \"bg-blue-500\" : \"bg-gray-200 dark:bg-gray-700\"\n              }`}\n            />\n          )}\n        </div>\n      ))}\n    </div>\n  );\n}\n\nfunction PaymentSection() {\n  const { machine, paymentMachine } = useCheckoutContext();\n  const state = machine.getState();\n\n  return state.match({\n    Payment: () => <PaymentFlow />,\n    _: () => null,\n  }, false);\n}\n\nfunction PaymentFlow() {\n  const { paymentMachine } = useCheckoutContext();\n  const state = paymentMachine?.getState();\n\n  if (!state) return null;\n\n  return (\n    <div className=\"border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-gray-50 dark:bg-gray-800\">\n      <h4 className=\"font-medium text-gray-900 dark:text-gray-100 mb-3\">Payment Method</h4>\n      \n      <div className=\"space-y-3\">\n        {state.match({\n          MethodEntry: () => (\n            <div>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-2\">Select payment method</p>\n              <button\n                onClick={() => paymentMachine?.authorize?.()}\n                className=\"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600\"\n              >\n                Authorize Payment\n              </button>\n            </div>\n          ),\n          Authorizing: () => (\n            <div className=\"flex items-center space-x-2\">\n              <div className=\"animate-spin w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full\" />\n              <span className=\"text-sm text-gray-600 dark:text-gray-400\">Authorizing...</span>\n            </div>\n          ),\n          AuthChallenge: () => (\n            <div>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-2\">Additional authentication required</p>\n              <div className=\"space-x-2\">\n                <button\n                  onClick={() => paymentMachine?.authSucceeded?.()}\n                  className=\"px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600\"\n                >\n                  Approve\n                </button>\n                <button\n                  onClick={() => paymentMachine?.authFailed?.()}\n                  className=\"px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600\"\n                >\n                  Deny\n                </button>\n              </div>\n            </div>\n          ),\n          AuthorizationError: () => (\n            <div>\n              <p className=\"text-sm text-red-600 dark:text-red-400 mb-2\">Authorization failed</p>\n              <button\n                onClick={() => paymentMachine?.retry?.()}\n                className=\"px-3 py. py- .bg-yellow .500 .white .rounded .hover:bg-yellow-600\"\n              >\n                Retry\n              </button>\n            </div>\n          ),\n          Authorized: () => (\n            <div className=\"flex items. .space .space-x 2 text .text-green .600 . .dark:text .400\">\n.>\n^\n              .svg .className=\" .w- .5 .h .5 .fill .currentColor .viewBox .0 0 20 20.>\n .path .fillRule .evenodd .d .M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z .clipRule .evenodd .>\n .svg>\n .span .className .text-sm .font-medium.>Payment Authorized</span>\n .div>\n          ),\n        }, null)}\n      </div>\n    </div>\n  );","status":"closed","issue_type":"bug","created_at":"2025-12-26T13:01:33.711252-06:00","updated_at":"2025-12-26T13:05:40.005767-06:00","closed_at":"2025-12-26T13:05:40.005767-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-mhd","title":"Fix behavioral bugs: Mermaid rendering, nested updates, layout reflow","description":"Functional JS bugs: Mermaid shows Loading indefinitely, nested mode stops updating after initial change, layout jumps on state change","design":"Debug Mermaid syntax in MermaidInspector.tsx, fix nested state subscription, investigate CSS/layout reflow triggers","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T14:11:41.60759-06:00","updated_at":"2025-12-27T14:15:19.214534-06:00","closed_at":"2025-12-27T14:15:19.214534-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-tm9","title":"Fix HSM visualizer bugs: Mermaid rendering, nested updates, layout, z-index, borders","description":"Functional bugs: Mermaid shows Loading indefinitely, nested mode stops updating after initial change, layout jumps on state change, dropdown overlaps visualizer heading, input border too faint","design":"Debug Mermaid syntax in MermaidInspector.tsx, fix nested state subscription, debug layout reflow, adjust dropdown z-index, improve input border styling","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T14:10:50.960984-06:00","updated_at":"2025-12-27T14:11:41.445567-06:00","closed_at":"2025-12-27T14:11:41.445567-06:00","close_reason":"Splitting behavioral bugs from cosmetic styling","dependency_count":0,"dependent_count":0}
{"id":"matchina-cso","title":"Fix HSM visualizer bugs: Mermaid rendering, nested updates, dark mode, layout, z-index","description":"All visualizer functional bugs: Mermaid shows Loading indefinitely, nested mode stops updating, layout jumps on state change, dark mode contrast issues, inactive tabs white, dropdown z-index overlap, input border contrast","design":"Debug Mermaid syntax error in MermaidInspector.tsx, fix nested state subscription, add dark mode variants to tab styling, fix layout reflow issues, adjust dropdown z-index, improve input border styling","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T14:09:35.53607-06:00","updated_at":"2025-12-27T14:10:50.794505-06:00","closed_at":"2025-12-27T14:10:50.794505-06:00","close_reason":"Splitting into bugs and styling","dependency_count":0,"dependent_count":0}
{"id":"matchina-xb3","title":"Colors: Mermaid light mode - add vibrancy using theme accent","description":"Mermaid diagrams in light mode are bland and lifeless with desaturated purple/lavender. Should use full theme accent colors to match dark mode brightness and polish.","design":"Update MermaidInspector.css light mode colors to use --sl-color-accent and --sl-color-accent-high with proper saturation","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-27T14:08:56.115576-06:00","updated_at":"2025-12-27T14:09:31.730527-06:00","closed_at":"2025-12-27T14:09:31.730527-06:00","close_reason":"Consolidating into grouped ticket","dependency_count":0,"dependent_count":0}
{"id":"matchina-8kh","title":"UX: Unified tab/toggle styling across example UI","description":"Two different tab styles in same examples: machine type toggle (Flattened/Nested) and visualizer type toggle (Sketch/Mermaid). Should use consistent styling across both.","design":"Apply same component/styling to both toggle sets so UI feels cohesive instead of pulled from different libraries","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-27T14:08:51.671531-06:00","updated_at":"2025-12-27T14:09:31.893797-06:00","closed_at":"2025-12-27T14:09:31.893797-06:00","close_reason":"Consolidating into grouped ticket","dependency_count":0,"dependent_count":0}
{"id":"matchina-jc3","title":"Bug: Nested Mermaid diagram stops updating after initial state change","description":"In nested mode, Mermaid visualizer works on first interaction but stops updating after subsequent state changes. Works fine in flattened mode.","design":"State subscription issue with nested machine in MermaidInspector.tsx","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T14:08:20.9778-06:00","updated_at":"2025-12-27T14:09:31.522337-06:00","closed_at":"2025-12-27T14:09:31.522337-06:00","close_reason":"Consolidating into grouped ticket","dependency_count":0,"dependent_count":0}
{"id":"matchina-yb0","title":"Bug: Mermaid visualizer shows 'Loading...' indefinitely","description":"Mermaid visualizer in HSM examples fails to render diagrams - shows 'Loading...' in all configurations (light/dark, flat/nested)","design":"Likely syntax error in Mermaid state machine definition","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T14:08:17.403638-06:00","updated_at":"2025-12-27T14:09:31.512239-06:00","closed_at":"2025-12-27T14:09:31.512239-06:00","close_reason":"Consolidating into grouped ticket","dependency_count":0,"dependent_count":0}
{"id":"matchina-i2m","title":"BUG: Combobox flattened FSM diagram missing transitions","description":"Combobox flattened HSM visualization shows states but no transitions between them. Need to investigate why shape builder or visualizer isn't capturing transition info for flattened machines.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T12:00:19.406123-06:00","updated_at":"2025-12-27T12:08:03.4147-06:00","closed_at":"2025-12-27T12:08:03.4147-06:00","close_reason":"Fixed with automatic transition discovery in shape-builders.ts. Now discovers both simple (params)=>state and curried (params)=>(ev)=>state forms by calling with dummy params.","dependency_count":0,"dependent_count":0}
{"id":"matchina-44o","title":"Fix hsm-traffic-light example: defineSubmachine not found","description":"## Bug Description\nThe traffic light example fails to load with:\n```\n(0 , __vite_ssr_import_0__.defineSubmachine) is not a function\n```\n\n## Root Cause\nThe example is using old API (`defineSubmachine`) that was removed during the definition semantics cleanup (matchina-abl).\n\n## Location\n- File: `docs/src/code/examples/hsm-traffic-light/machine-flat.ts`\n\n## Fix Strategy\nUpdate the traffic light example to use the new shape-based approach:\n1. Remove `defineMachine`, `defineSubmachine`, `flattenMachineDefinition` imports\n2. Use `createFlatMachine` or `createDeclarativeFlatMachine` instead\n3. Follow pattern from hsm-checkout or declarative-checkout examples\n4. Ensure visualization still works with shape metadata\n\n## Acceptance Criteria\n- Example loads without errors\n- Traffic light state machine works as expected\n- Visualization displays correctly with flattened hierarchy\n- No references to removed `defineSubmachine` API","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T11:28:39.057135-06:00","updated_at":"2025-12-27T11:38:11.801699-06:00","closed_at":"2025-12-27T11:38:11.801699-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-hxq","title":"Fix hsm-combobox example: selectedTags.map error on load","description":"## Bug Description\nThe flattened combobox example crashes on load with:\n```\nUncaught TypeError: (currentData.selectedTags || []).map is not a function\n    at ComboboxViewFlat (ComboboxViewFlat.tsx:112:45)\n```\n\n## Root Cause\nFixed in src/factory-machine.ts:70 but docs need rebuild, or there's a remaining issue with how initial state data is being set in the combobox example.\n\n## Location\n- File: `docs/src/code/examples/hsm-combobox/ComboboxViewFlat.tsx:112`\n- Related: `docs/src/code/examples/hsm-combobox/machine-flat.ts`\n\n## Fix Strategy\n1. Verify the fix from factory-machine.ts is being used (rebuild docs if needed)\n2. Ensure initial state of Inactive properly initializes with `selectedTags: []`\n3. Test that state transitions preserve array type for selectedTags\n\n## Acceptance Criteria\n- Example loads without errors\n- selectedTags is always an array throughout all state transitions\n- UI properly displays selected tags","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T11:28:38.701894-06:00","updated_at":"2025-12-27T11:38:11.789122-06:00","closed_at":"2025-12-27T11:38:11.789122-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-fgh","title":"Bug: Flattened combobox missing nesting/transitions visible in nested version","description":"FIXED:\nChanged hsm-combobox/machine-flat.ts to use createMachineFromFlat() instead of matchina().\n\nThis automatically attaches shape metadata via createStaticShapeStore().\n\nThe buildVisualizerTree function detects the shape and renders the correct hierarchy with transitions.\n\nReady for browser testing.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T10:38:29.963659-06:00","updated_at":"2025-12-27T12:12:53.590697-06:00","closed_at":"2025-12-27T12:12:53.590697-06:00","close_reason":"Fixed by automatic transition discovery in shape-builders.ts. Both flattened and nested machines now properly discover function-based transitions.","dependency_count":0,"dependent_count":0}
{"id":"matchina-a4f","title":"Fix: createMachine called with undefined initialState in hsm-combobox ComboboxView.tsx","description":"TypeError: Cannot read properties of undefined (reading 'key') at createMachine. Line 8 of ComboboxView.tsx passes undefined as initialState. Fixed by creating dummy state factory.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T10:36:09.003938-06:00","updated_at":"2025-12-27T12:13:35.673939-06:00","closed_at":"2025-12-27T12:13:35.673939-06:00","close_reason":"All fixed/complete: azu=rename done, a4f=ComboboxView has fix, y3k=implementation complete per notes","dependency_count":0,"dependent_count":0}
{"id":"matchina-b3z","title":"BUG: buildNestedShape returns empty states for hierarchical machines","description":"buildNestedShape is being called from createDynamicShapeStore but returns empty state maps.\n\nOBSERVATIONS:\n- createDynamicShapeStore calls buildNestedShape(root) at line 379 of propagateSubmachines.ts\n- The shape store is created correctly (getXStateDefinition finds it)\n- But shape.getState() returns { states: Map(0), transitions: Map(0), hierarchy: Map(0), initialKey: '', type: 'nested' }\n- This causes buildDefinitionFromShape to fail because there are no states to process\n\nHYPOTHESIS:\n- buildNestedShape walks the machine hierarchy to collect states\n- It might be called before the hierarchy is fully established in propagateSubmachines\n- Or it's walking the wrong machine reference\n\nNEXT STEPS:\n1. Add logging to buildNestedShape to see what transitions it finds\n2. Check if root.transitions is populated when buildNestedShape is called\n3. Verify the machine has proper transitions object structure\n4. Check if hierarchical machines have flattened transitions or nested ones\n\nTEST FAILURES:\n- test/hsm-visualization-unified.test.ts: 3 tests fail when getXStateDefinition uses shape store\n  - Payment.states is undefined (no nested states found)\n  - Active.states is undefined (no nested states found)\n","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T09:42:07.995271-06:00","updated_at":"2025-12-27T09:51:58.000099-06:00","closed_at":"2025-12-27T09:51:58.000099-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-bbd","title":"DESIGN: Conflicting approaches to visualization definitions (nested vs flattened)","description":"The visualization system has two conflicting approaches:\n\nAPPROACH 1 - Flattened Machines (Static Definition):\n- Attaches _originalDef to the machine object (runtime data + metadata coupling)\n- Uses buildDefinitionFromFlattened which relies on this attached definition\n- Preserves hierarchical structure for visualization purposes\n\nAPPROACH 2 - Nested Machines (Runtime Introspection):\n- No definition attached to machine\n- Uses buildDefinition which introspects machine.states and machine.transitions at visualization time\n- Walks nested machines via state.data.machine references\n\nCONFLICTS:\n1. Separation of Concerns: _originalDef is a visualization concern coupled to runtime machines\n2. Consistency: Why do flattened machines preserve definition but nested don't?\n3. Submachine Handling: Nested machines discover submachines via introspection AND via machineFactory.def - two separate mechanisms\n4. Scalability: Introspection requires instantiating machines; static definitions avoid this\n5. Maintenance: Adding visualization features requires changes to machine creation, not just visualization code\n\nDESIGN QUESTIONS:\n- Should _originalDef be public API or internal implementation detail?\n- Should visualization system use static definitions or runtime introspection?\n- Should ALL machines preserve their definition for visualization? Or none?\n- Can visualization be fully separated from runtime machine concerns (via hooks)?\n- Should submachine discovery be unified (one mechanism, not two)?\n\nCURRENT STATE:\n- Works but has code smell of mixed concerns\n- Two different paths through getXStateDefinition create cognitive load\n- Unclear which approach is 'correct' for new machine types\n- Nested machines with submachines have complex introspection logic (lines 93-165)","notes":"DESIGN DECISION: DEFINITIONS ARE GONE\n\nShape store was supposed to be unified, but visualization still had definition fallback.\nThat experiment is dead. Removing ALL definition code.\n\nSOLUTION: Shape-only visualization\n- buildVisualizerTree() takes shape, returns tree for rendering\n- No introspection, no definitions, no fallbacks\n- Auto-attach shapes in matchina() when needed\n- matchina-edz will be fixed by this cleanup","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T09:02:56.603878-06:00","updated_at":"2025-12-27T10:27:04.634237-06:00","closed_at":"2025-12-27T10:27:04.634237-06:00","close_reason":"Shape-only visualization cleanup complete. Definitions removed, auto-attach working, combobox fixed. 143/143 tests pass.","dependency_count":0,"dependent_count":0}
{"id":"matchina-6da","title":"Implement unified HSM visualization for hierarchical and flattened machines","description":"Implement the unified HSM visualization approach designed in matchina-jt7.\n\nImplementation tasks:\n1. Update inspection layer (getXStateDefinition) to handle both approaches consistently\n2. Fix SketchInspector state matching logic for flattened keys\n3. Update CSS styling to work properly for both hierarchical and flattened structures\n4. Ensure proper highlighting of active states in flattened HSMs\n5. Test both hierarchical and flattened checkout examples\n\nDesign notes (from matchina-jt7):\n- [Design will be populated here after matchina-jt7 is completed]\n\nDependencies:\n- Requires design completion from matchina-jt7\n- Requires analysis completion from matchina-qr8\n\nTesting:\n- Verify hierarchical HSM visualization still works\n- Verify flattened HSM visualization now works correctly\n- Test both light and dark themes\n- Test multiple nesting levels","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T07:30:07.384354-06:00","updated_at":"2025-12-27T07:34:41.915153-06:00","closed_at":"2025-12-27T07:34:41.915153-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-jt7","title":"Design unified HSM visualization approach for hierarchical and flattened machines","description":"Based on analysis from matchina-qr8, design a unified approach for HSM visualization that works consistently for both hierarchical and flattened machines.\n\nDesign requirements:\n1. Consistent state key matching regardless of HSM approach\n2. Proper visual hierarchy showing nesting/containment\n3. Correct highlighting of active states and ancestors\n4. Theme-compatible styling (light/dark)\n\nDesign considerations:\n- Should inspection layer normalize keys or should viz layer handle both?\n- How to map flattened keys (Payment.MethodEntry) to hierarchical structure\n- Whether to use dot notation universally or maintain approach-specific formats\n- How to handle state matching in SketchInspector for both approaches\n- CSS styling approach that works for both structures\n\nExpected deliverables:\n1. Clear design document with approach decision\n2. Specification of key format normalization (if needed)\n3. Updated inspection layer requirements\n4. Updated visualization layer requirements\n5. CSS styling approach that supports both\n\nThis design will be implemented in matchina-k3l.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T07:30:01.475568-06:00","updated_at":"2025-12-27T07:31:42.278648-06:00","closed_at":"2025-12-27T07:31:42.278648-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-qr8","title":"Analyze HSM state key handling differences between hierarchical and flattened approaches","description":"The visualization layer is not properly handling state key matching between hierarchical and flattened HSM approaches. \n\nIn hierarchical HSMs:\n- State keys are simple (e.g., 'Payment')\n- Nested states are accessed via state.data.machine\n- Visualization walks the machine tree to build full paths\n\nIn flattened HSMs:\n- State keys include dots (e.g., 'Payment.MethodEntry')\n- No nested machine structure\n- Visualization needs to parse dot notation and match accordingly\n\nCurrent issues:\n1. SketchInspector state matching logic may not work correctly for flattened keys\n2. The inspection layer (getXStateDefinition) and visualization layer may have inconsistent key handling\n3. Styling assumes hierarchical structure but flattened machines have different structure\n\nNeed to analyze:\n- How state keys are generated and matched in each approach\n- How the inspection layer should normalize or handle both approaches\n- How the visualization layer should consistently render both approaches\n- Whether we need a unified abstraction or approach-specific handling","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T07:29:50.936373-06:00","updated_at":"2025-12-27T07:31:40.654479-06:00","closed_at":"2025-12-27T07:31:40.654479-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-7vj","title":"Flattened Combobox HSM diagram STYLING is not highlighting nested state well","description":"The whole point is to be an HSM but diagram is not showing nesting. After much research it seems to just be a styling issue. We need better styling on background of that nested thing. Should also have the green border, and the BGs on those should have a bit of transparency so that the shades vary across the levels.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T07:14:41.168623-06:00","updated_at":"2025-12-27T07:29:47.347167-06:00","closed_at":"2025-12-27T07:29:47.347167-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-a9w","title":"Flattened HSM Checkout example -- Viz loses nested state","description":"After entering payment, the diagrams are unable to match nested states for some reason. When state is Payment.MethodEntry the viz is not able to match it. There is a problem with how we are mapping things and states. We probably need to step back and think about how to do this well, possibly write about analysis and plan in notes on this ticket before fixing.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T07:11:34.541475-06:00","updated_at":"2025-12-27T07:15:00.49963-06:00","closed_at":"2025-12-27T07:15:00.49963-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-mcg","title":"DO NOT SHARE VIEWs across DIFFERENT HSM types!!","description":"The two HSM types are incompatible because they use different state keys. It is BAD practice for our examples to try to handle both cases in one view. STOP doing this and FIX the places where we are doing this.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T07:09:00.263726-06:00","updated_at":"2025-12-27T07:35:30.284751-06:00","closed_at":"2025-12-27T07:35:30.284751-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-7ji","title":"flattened checkout example error enterinig payment","description":"clicking Proceed to Payment fails and logs\nmatchbox-factory.mjs:71 Uncaught Error: Match did not handle key: 'Payment.MethodEntry'\n    at MatchboxImpl.match (matchbox-factory.mjs:71:11)\n    at CheckoutControls (CheckoutView.tsx:220:14)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T06:58:37.230812-06:00","updated_at":"2025-12-27T06:59:14.242456-06:00","closed_at":"2025-12-27T06:59:14.24247-06:00","dependency_count":0,"dependent_count":0}
{"id":"matchina-12s","title":"Mermaid visualizer broken - shows Loading forever","description":"Mermaid diagram tab never renders, stays on Loading state. Captured in visual review screenshots. Blocks full visualizer functionality.","notes":"Added error handling to Mermaid.tsx - now shows error instead of Loading forever. Root cause is Vite dev server dynamic import caching issue with mermaid's lazy-loaded diagram types. Error: 'Failed to fetch dynamically imported module: stateDiagram-v2-*.js'. Workaround: restart dev server to clear Vite cache.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T19:19:37.161233-06:00","updated_at":"2025-12-27T06:57:24.087323-06:00","closed_at":"2025-12-27T06:57:24.087328-06:00","dependency_count":0,"dependent_count":0}
{"id":"matchina-63u","title":"Nested hierarchical checkout lost hierarchy in diagrams","description":"Something has been lost from feature/hsm-with-viz where we figured out the nested/propagate impl. On the plus side the flattened checkout shows correct hierarchy in viz.\npeer example of flattened/nested traffic light DOES show hierarchy correctly in viz for both versions.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T13:17:46.200498-06:00","updated_at":"2025-12-26T13:31:31.383825-06:00","closed_at":"2025-12-26T13:31:31.383825-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-04c","title":"flattened hsm combobox example UI goes dead when clicked into","description":"combobox disappears. ends up in empty state with seemingly no way out. we need to get this adapted. ","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T13:15:25.283313-06:00","updated_at":"2025-12-26T21:00:10.943299-06:00","closed_at":"2025-12-26T21:00:10.943299-06:00","close_reason":"Closed","dependency_count":1,"dependent_count":0}
{"id":"matchina-ei5","title":"nested combobox stopped working","description":"did work on original branch we ported it from.\ntyping causes\nUncaught TypeError: activeMachine?.typed is not a function","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T13:13:39.346865-06:00","updated_at":"2025-12-26T21:00:10.948569-06:00","closed_at":"2025-12-26T21:00:10.948569-06:00","close_reason":"Closed","dependency_count":1,"dependent_count":0}
{"id":"matchina-zc0","title":"hsm flattened checkout example - error entering payment","description":"nested buttons work now.\nflattened breaks on proceed to payment\nmatchbox-factory.mjs:71 Uncaught Error: Match did not handle key: 'Payment.MethodEntry'\n    at MatchboxImpl.match (matchbox-factory.mjs:71:11)\n\nare we trying to make them use the same UI? would not be necessary. fix  flattened buttons","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T13:10:33.070618-06:00","updated_at":"2025-12-27T07:12:22.057469-06:00","closed_at":"2025-12-27T07:12:22.057473-06:00","dependency_count":0,"dependent_count":0}
{"id":"matchina-ccb","title":"Combobox throws errors on click in both versions","description":"USED TO WORK ON BRANCH feature/hsm-with-viz\nand NEEDS TO WORK for flattened also. Use your head. \n\nUncaught Error: Match did not handle key: 'Active.Empty'\n    at MatchboxImpl.match (matchbox-factory.mjs:66:11)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T12:59:32.807975-06:00","updated_at":"2025-12-26T13:05:40.012871-06:00","closed_at":"2025-12-26T13:05:40.012871-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-0vb","title":"HSM flatten-based docs update","description":"Update hierarchical-machines.mdx guide to focus on flatten-based approach.\\n\\nCurrent guide covers both flatten and propagate. Update to:\\n1. Lead with flatten approach as primary\\n2. Add flatten-based examples\\n3. Move propagation to 'advanced' or separate section\\n\\nDepends on: matchina-b96 (examples spike)","notes":"Depends on matchina-b96 (examples spike)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-26T06:56:34.46363-06:00","updated_at":"2025-12-26T07:21:52.73075-06:00","closed_at":"2025-12-26T07:21:52.73075-06:00","close_reason":"Guide already leads with flatten approach. Added link to interactive example.","dependency_count":0,"dependent_count":0}
{"id":"matchina-b96","title":"HSM flatten-based examples spike","description":"Port HSM examples from feature/hsm-with-viz and adapt them to work with flattened machine definitions (no propagation required).\\n\\nExamples to port:\\n- hsm-checkout\\n- hsm-combobox\\n- hsm-nested-vs-flattened\\n\\nApproach: Use flattenMachineDefinition + createMachineFromFlat instead of propagateSubmachines.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-26T06:56:27.695972-06:00","updated_at":"2025-12-26T07:00:47.398411-06:00","closed_at":"2025-12-26T07:00:47.398411-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-1av","title":"Review: Evaluate examples for consistency and library usage","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T06:53:24.276481-06:00","updated_at":"2025-12-22T07:01:20.804509-06:00","closed_at":"2025-12-22T07:01:20.804509-06:00","close_reason":"Completed examples review - checkout clean, searchbar overcomplicated, nested-vs-flattened useful for docs","dependency_count":0,"dependent_count":1}
{"id":"matchina-1r3","title":"Make Mermaid flowchart viz support nesting","description":"Mermaid state chart shows nested machines but flowchart version does not.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-22T06:36:23.120013-06:00","updated_at":"2025-12-22T06:38:52.884144-06:00","closed_at":"2025-12-22T06:38:52.884144-06:00","close_reason":"Added recursive nesting support to toStateDiagram using subgraphs","dependency_count":0,"dependent_count":0}
{"id":"matchina-vzq","title":"Nested tick event not working in traffic light example","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-22T00:01:31.993729-06:00","updated_at":"2025-12-22T00:12:54.665645-06:00","closed_at":"2025-12-22T00:12:54.665645-06:00","close_reason":"Fixed: propagateSubmachines now creates a new change event when child transitions, enabling React's useSyncExternalStore to detect changes. Added FactoryMachineEventImpl import and modified child.change handler to call transition() with a self-transition event (same from/to state but new event object). All tests pass including new hsm.react-change-detection.test.ts that specifically verifies the fix.","dependency_count":0,"dependent_count":0}
{"id":"matchina-d9m","title":"Dark mode styling: Tab colors, nested state backgrounds","description":"Dark mode visual issues: Inactive visualizer tabs stay white, nested state boxes use white backgrounds, Mermaid dark mode contrast needs work","design":"Add dark mode variants to tab styling, update nested state box colors for dark theme","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T14:10:53.801601-06:00","updated_at":"2025-12-27T14:11:16.401661-06:00","closed_at":"2025-12-27T14:11:16.401661-06:00","close_reason":"Those are behavioral bugs, not cosmetic styling","dependency_count":0,"dependent_count":0}
{"id":"matchina-55k","title":"Bug: Combobox input border too faint - contrast issue","description":"Input border lacks sufficient contrast in both light and dark modes, making focus state unclear","design":"Increase border contrast or add focus ring styling","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-27T14:08:36.606437-06:00","updated_at":"2025-12-27T14:09:31.546272-06:00","closed_at":"2025-12-27T14:09:31.546272-06:00","close_reason":"Consolidating into grouped ticket","dependency_count":0,"dependent_count":0}
{"id":"matchina-94q","title":"Bug: Sketch nested states use white backgrounds in dark mode","description":"In dark mode, nested child state boxes in Sketch visualizer use white backgrounds that don't adapt to theme. Also have low contrast transition button text.","design":"Update SketchInspector.css to use theme-aware colors for nested state boxes","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-27T14:08:30.419854-06:00","updated_at":"2025-12-27T14:09:31.536382-06:00","closed_at":"2025-12-27T14:09:31.536382-06:00","close_reason":"Consolidating into grouped ticket","dependency_count":0,"dependent_count":0}
{"id":"matchina-x3i","title":"Bug: Sketch inspector layout jumps when interacting with combobox","description":"Sketch visualizer layout reflows/jumps when typing in combobox or changing state - shouldn't cause visual reflow","design":"Investigate CSS in SketchInspector.tsx that causes reflow on state changes","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-27T14:08:24.097722-06:00","updated_at":"2025-12-27T14:09:31.526467-06:00","closed_at":"2025-12-27T14:09:31.526467-06:00","close_reason":"Consolidating into grouped ticket","dependency_count":0,"dependent_count":0}
{"id":"matchina-0nh","title":"REFACTOR: Separate views for flattened vs nested HSM examples","description":"HSM examples currently use ONE view with conditional rendering for BOTH flattened and nested machines. This is wrong.\n\nPROBLEM:\n- Two machines (flat/nested), one view doing conditional labor\n- Users will only want ONE approach, never BOTH\n- Makes examples harder to use/understand\n\nSOLUTION:\n- Separate views for each machine type\n- Share code where it makes sense, but assume need for separate views\n- Clean separation makes examples more usable\n\nAFFECTED EXAMPLES:\n- hsm-traffic-light\n- hsm-combobox\n- hsm-checkout\n\nEach should have:\n- machine.ts (nested)\n- machine-flat.ts (flattened)\n- View.tsx (for nested)\n- ViewFlat.tsx (for flattened)\n- Shared utilities OK, but not shared conditional views","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T12:20:41.870318-06:00","updated_at":"2025-12-27T12:27:25.939513-06:00","closed_at":"2025-12-27T12:27:25.939513-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-y3k","title":"Design elegant declarative API for creating flattened HSMs","description":"CORE REQUIREMENT:\nProvide an ELEGANT, DRY way to define hierarchical state machines that auto-flatten.\n\nCURRENT PROBLEM (BAD):\nThe example manually writes out dot-notation states and transitions everywhere:\n- 'Payment.MethodEntry', 'Payment.Authorizing', etc repeated everywhere\n- Transitions defined outside function (breaks type inference)\n- Manual synthetic parent states (Payment) - violates DRY\n- Not elegant or declarative\n\nDESIRED APPROACH (GOOD):\ncreateFlatMachine takes a declarative hierarchical shape:\n- Define hierarchy ONCE (like nested machines do)\n- Auto-flattens to dot-notation internally\n- Generates synthetic parent states automatically\n- Type inference works properly (transitions inline with machine creation)\n- DRY and elegant\n\nDESIGN GOAL:\ncreateFlatMachine(declarativeHierarchicalShape) API where:\n1. User defines the hierarchical structure declaratively (nested objects)\n2. Library handles all the flattening, dot-notation, synthetic parents internally\n3. Type inference works because everything is in one call\n4. Result is a flat machine with proper shape metadata\n\nREFERENCES:\n- This has been documented in project docs (AGENTS.md or similar)\n- Examples should follow the pattern of inline transitions, not external vars\n","notes":"## ✅ IMPLEMENTATION COMPLETE\n\nSuccessfully designed and implemented elegant declarative API for flattened HSMs!\n\n**Deliverables:**\n1. `createDeclarativeFlatMachine()` - New primary API for flat machines\n2. Comprehensive documentation with examples\n3. Full test coverage (4 new tests, all passing)\n4. Example code in docs/src/code/examples/declarative-checkout/\n5. Exported from matchina nesting module\n\n**Key Features Implemented:**\n- Hierarchical config, auto-flattens internally  \n- Relative refs: 'Authorizing' → 'Payment.Authorizing'\n- Parent escape: '^Cart' goes up one level\n- Auto-resolves parent states to initial children\n- DRY - define hierarchy once, no repetition\n- Type inference works (inline transitions)\n\n**Files Modified:**\n- src/nesting/declarative-flat.ts (new, 250+ lines with docs)\n- src/nesting/index.ts (export new API)\n- test/declarative-flat.test.ts (new, 4 tests)\n- docs/src/code/examples/declarative-checkout/machine.ts (example)\n\n**Test Results:** \n- 134/134 unit tests passing\n- 4/4 declarative-flat tests passing\n- All existing functionality preserved\n\nReady for user review and potential follow-up work (updating existing examples to use new API).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T11:03:20.291047-06:00","updated_at":"2025-12-27T12:13:35.677049-06:00","closed_at":"2025-12-27T12:13:35.677049-06:00","close_reason":"All fixed/complete: azu=rename done, a4f=ComboboxView has fix, y3k=implementation complete per notes","dependency_count":0,"dependent_count":0}
{"id":"matchina-cuz","title":"Flattened child.exit needs earlier hook integration","description":"PARTIAL SUCCESS: Flattening fix worked - Authorized transitions are now empty as intended. BUT this reveals the real issue: child states need parent transitions to handle child.exit events. In flattened machines, Payment.Authorized has NO transitions, so child.exit cannot be processed. We need a different approach: either 1) Copy only child.exit transitions to children, or 2) Implement fallback logic that checks parent transitions when child has none.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:10:32.968156-06:00","updated_at":"2025-12-27T09:03:06.65122-06:00","closed_at":"2025-12-27T09:03:06.65122-06:00","close_reason":"Resolved by matchina-6dt: withFlattenedChildExit now applied automatically in createMachineFromFlat. Parent transitions accessible via fallback hook. Flattened machines now behave identically to nested machines for child.exit.","dependency_count":1,"dependent_count":0}
{"id":"matchina-0xj","title":"Fix flattened machine child.exit behavior to match nested semantics","description":"Flattened machines don't automatically trigger child.exit when reaching final child states like nested machines do. Implement effects-based solution to detect final child states (via change.to.data?.final) and automatically trigger child.exit transitions. This depends on implementing the parent transition fallback hook first to ensure flattened machines have clean separation between parent and child transitions.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:02:34.704398-06:00","updated_at":"2025-12-27T08:15:49.377602-06:00","closed_at":"2025-12-27T08:15:49.377602-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-iur","title":"Implement parent transition fallback hook for flattened machines","description":"Create a hook that catches unmatched transitions in flattened machines and tries parent states. When a transition is not found in the current dot-separated state (e.g., 'Payment.Authorized'), the hook should strip the last segment and try the parent state ('Payment'). This enables parent transitions to be available from child states without polluting child states with inherited transitions.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:02:31.59591-06:00","updated_at":"2025-12-27T08:09:08.51651-06:00","closed_at":"2025-12-27T08:09:08.51651-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-crt","title":"HSM visualization broken - state inspection not working across all scenarios","description":"After implementing unified HSM visualization approach, all visualizations (Sketch, Mermaid, ReactFlow) are no longer correctly identifying or displaying the current active state. This affects both hierarchical and flattened machines across all examples (combobox, checkout). The state highlighting and path detection is completely broken.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T07:37:29.836413-06:00","updated_at":"2025-12-27T07:42:13.998433-06:00","closed_at":"2025-12-27T07:42:13.998433-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-du2","title":"Fix checkout payment screen - empty body with footer buttons","description":"The checkout payment screen shows an empty body area but still displays footer buttons. The content area should show the payment child machine content properly.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-26T12:45:46.530429-06:00","updated_at":"2025-12-26T12:47:29.684519-06:00","closed_at":"2025-12-26T12:47:29.684519-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-fhl","title":"Fix Tag List editor flattened version - machine.focus is not a function","description":"When using the flattened version of the Tag List editor, clicking 'Click to add tags' throws 'Uncaught TypeError: machine.focus is not a function' at ComboboxView.tsx:135:32. The hierarchical version works fine.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-26T12:45:44.363829-06:00","updated_at":"2025-12-26T12:47:29.683148-06:00","closed_at":"2025-12-26T12:47:29.683148-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-5lq","title":"Fix sidebar titles: change 'HSM' to 'Hierarchical' in examples","description":"The sidebar shows 'HSM Traffic Light', 'HSM Combobox', 'HSM Checkout' but should show 'Hierarchical Traffic Light', etc. for consistency with user preference.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-26T12:45:42.387849-06:00","updated_at":"2025-12-26T12:47:29.679042-06:00","closed_at":"2025-12-26T12:47:29.679042-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-8yh","title":"Implement flat versions and toggles for remaining HSM examples","description":"## What Was Done\n- Cleaned up HSM examples: removed redundant comparison directories (hsm-combobox-comparison, hsm-checkout-comparison, hsm-traffic-light-flat)\n- Renamed hsm-traffic-light-comparison to hsm-traffic-light with sticky toggle\n- Updated sidebar to remove 'Comparison' wording, simplified to 3 entries\n- Made toggle sticky below header bars with backdrop blur\n- Updated title to 'Hierarchical Traffic Light' for clarity\n\n## What Still Needs to Be Done\n- **hsm-combobox**: Create flat machine version (machine-flat.ts) and toggle UI in example.tsx\n- **hsm-checkout**: Create flat machine version (machine-flat.ts) and toggle UI in example.tsx  \n- **Visualizer consistency**: Ensure both examples use same visualizer pattern as traffic light (MachineExampleWithChart/VisualizerDemo)\n- **Remove redundant comparison tables**: Keep comparison table only in traffic light example unless different nuances exist\n- **Pattern consistency**: Match the traffic light example structure without redundancy\n- **Add to sidebar**: Once flat versions are implemented, add hsm-combobox and hsm-checkout back to sidebar\n\n## Technical Notes\n- Current hsm-combobox and hsm-checkout are unstaged and ready for implementation\n- Need to follow same pattern as hsm-traffic-light: flat vs nested toggle with sticky positioning\n- Visualizer should be consistent across all examples","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T12:24:17.281129-06:00","updated_at":"2025-12-26T12:26:45.518579-06:00","closed_at":"2025-12-26T12:26:45.518579-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-jjx","title":"docs/hsm-propagation-examples: HSM propagation examples (optional)","description":"Higher-level examples that rely on propagation / child routing.\n\nFiles:\n- docs/src/content/docs/examples/hsm-checkout.mdx (new)\n- docs/src/content/docs/examples/hsm-combobox.mdx (new)\n- docs/src/code/examples/hsm-checkout/* (new)\n- docs/src/code/examples/hsm-combobox/* (new)\n\nDependencies: feat/hsm-propagation\nPriority: Phase 3 (optional)\nBranch: docs/hsm-propagation-examples","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:55:15.439191-06:00","updated_at":"2025-12-26T06:25:57.551257-06:00","closed_at":"2025-12-26T06:25:57.551257-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-1ar","title":"feat/hsm-propagation: Event propagation / child-first routing (optional)","description":"Event propagation / child-first routing. Useful, but not required for hierarchy support if flattening is the primary mechanism.\n\nFiles:\n- src/nesting/propagateSubmachines.ts (new)\n- src/nesting/submachine.ts (new)\n- src/nesting/types.ts (new)\n- src/nesting/readHierarchicalFullKey.ts (new)\n- src/index.ts (exports)\n- test/hsm.*.ts (all HSM tests)\n- test/propagateSubmachines.bubble.test.ts\n\nDependencies: feat/hsm-definition-format, feat/machine-branding, feat/send-hook\nPriority: Phase 3 (optional)\nBranch: feat/hsm-propagation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:55:12.090983-06:00","updated_at":"2025-12-26T06:25:57.545384-06:00","closed_at":"2025-12-26T06:25:57.545384-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-ml8","title":"docs/hsm-flatten-guide: HSM documentation (flattening-first)","description":"Orient docs towards flattening first. Keep propagation as an optional section/follow-up.\n\nFiles:\n- docs/src/content/docs/guides/hierarchical-machines.mdx (new)\n- docs/src/content/docs/examples/hsm-overview.mdx (new)\n- docs/src/content/docs/examples/hsm-nested-vs-flattened.mdx (new)\n- docs/src/code/examples/hsm-nested-vs-flattened/* (new)\n- docs/astro.config.mjs (nav additions for HSM)\n- docs/src/content/docs/index.mdx (HSM links)\n- README.md (HSM section)\n\nDependencies: feat/hsm-definition-format, feat/hsm-flatten\nPriority: Phase 2 (HSM definition-first)\nBranch: docs/hsm-flatten-guide","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:54:58.338228-06:00","updated_at":"2025-12-26T06:00:14.339607-06:00","closed_at":"2025-12-26T06:00:14.339607-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-4ms","title":"feat/hsm-inspect-core: HSM inspection utilities (externalizable)","description":"Keep inspection as propagation-independent as possible: prefer operating on definitions and/or current state shape.\n\nFiles:\n- src/nesting/inspect.ts (new)\n- test/context-propagation-bug.test.ts\n- test/context-propagation-bug.test.tsx\n- test/debug-context-propagation.test.tsx\n\nDependencies: feat/hsm-definition-format\nPriority: Phase 2 (HSM definition-first)\nBranch: feat/hsm-inspect-core","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:54:53.310969-06:00","updated_at":"2025-12-26T06:30:26.646567-06:00","closed_at":"2025-12-26T06:30:26.646567-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-9vg","title":"feat/hsm-flatten: Flatten nested definitions (core path)","description":"Flatten nested definitions into a single-level keyspace. This is the preferred HSM path and should remain independent of propagation.\n\nFiles:\n- src/definitions.ts (flattening exports live here today; may move later)\n- test/flatten.types.ts (new)\n\nDependencies: feat/hsm-definition-format\nPriority: Phase 2 (HSM definition-first)\nBranch: feat/hsm-flatten","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:54:49.734978-06:00","updated_at":"2025-12-26T06:00:14.333979-06:00","closed_at":"2025-12-26T06:00:14.333979-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-9zr","title":"feat/hsm-definition-format: Core xstate-ish machine definition format","description":"Core xstate-ish machine definition format (states, transitions, initial). This is the stable base that inspection/viz should target.\n\nFiles:\n- src/definitions.ts (new)\n- src/definition-types.ts (new)\n- test/definitions.test.ts (new)\n\nDependencies: fix/types\nPriority: Phase 2 (HSM definition-first)\nBranch: feat/hsm-definition-format","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T04:54:46.33799-06:00","updated_at":"2025-12-26T06:00:14.323838-06:00","closed_at":"2025-12-26T06:00:14.323838-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-fkw","title":"HSM packaging: Export from matchina/hsm","description":"Export flattening APIs from matchina/hsm subpath, mark propagation experimental.\n\nTasks:\n- Create/update matchina/hsm entry point\n- Export flattening APIs: flattenMachineDefinition, defineSubmachine, defineMachine\n- Export propagation APIs with experimental marker\n- Verify tree-shaking works\n\nAcceptance:\n- import { flattenMachineDefinition } from 'matchina/hsm' works\n- Propagation doesn't get bundled if not imported\n\nBlocks: branch merge","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T16:18:02.104911-06:00","updated_at":"2025-12-25T16:20:51.958958-06:00","closed_at":"2025-12-25T16:20:51.958967-06:00","dependency_count":0,"dependent_count":0}
{"id":"matchina-6eh","title":"Design: Decide between HSM Flattening vs Propagation","description":"Two competing HSM approaches exist without clear guidance:\\n1. Flattening (definitions.ts) - compile-time, produces dot-separated keys\\n2. Propagation (propagateSubmachines.ts) - runtime, preserves nested structure\\n\\nNeed to either:\\n- Pick one as primary and deprecate the other\\n- Clearly differentiate use cases in docs\\n- Document trade-offs (type inference, performance, debugging)\\nRef: review/01-architecture.md, review/90-synthesis.md","notes":"Completed in this branch. HSM APIs exported from matchina/hsm with flattening as primary and propagation as experimental escape hatch.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T12:18:19.717669-06:00","updated_at":"2025-12-25T16:35:58.521584-06:00","closed_at":"2025-12-25T16:35:58.521627-06:00","labels":["decision"],"dependency_count":0,"dependent_count":0}
{"id":"matchina-dco","title":"Mermaid vis seems to have lost clickable available actions","description":"in mermaid diagrams we generally want interactivity except where the machine/ui requires parameters be sent. i am not seeing this behavior in some of our diagrams. maybe we changed it to default to noninteractive. currently working on hierarchical examples for tag list editor and checkout flow, but would also like to add viz to the nested vs flattened examples, but all of those should allow interactivity in the diagram except where parameters are required, and even if they are there is probably a way to create a parameterless extension that handles that part.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-25T08:54:11.806514-06:00","updated_at":"2025-12-25T11:04:45.233561-06:00","closed_at":"2025-12-25T11:04:45.233561-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-eqn","title":"Nested machine visualizations should probably allow ancestor actions to be invoked","description":"ie while in payment, UI shows ability to go back, exit or child.exit, but in visualizer those are not clickable. they should be","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-25T08:50:29.349181-06:00","updated_at":"2025-12-25T11:03:44.482838-06:00","closed_at":"2025-12-25T11:03:44.482838-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-d38","title":"Examples are buried by AI Slop","description":"AI slop at top of HSM example MDX pages pushes examples down. Examples should have priority with minimal initial explanation.\n\nSPECIFIC ISSUES:\n- Traffic light: Intro could be condensed (comparison table is good)\n- Combobox/Checkout: Useless content at top pushing examples down\n- Pattern: Non-essential explanation should be BELOW examples, not above\n\nPRINCIPLE:\nExamples have priority. Should require minimal initial explanation to understand intuitively. Consider: 'Toggle below between flattened and nested HSM implementations'\n\nLOCATION: docs/src/content/docs/examples/hsm-*.mdx files","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-26T13:12:19.164516-06:00","updated_at":"2025-12-27T12:30:04.827488-06:00","closed_at":"2025-12-27T12:30:04.827488-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-678","title":"API: Export HSM APIs from main package","description":"HSM APIs not properly exported, forcing demos to use deep imports:\\n- submachine (src/nesting/submachine.ts)\\n- defineMachine (src/definitions.ts)\\n- createHierarchicalMachine (src/nesting/propagateSubmachines.ts)\\n- defineSubmachine (src/definitions.ts)\\n- flattenMachineDefinition (src/definitions.ts)\\n\\nEither export from 'matchina' or create 'matchina/hsm' subpath.\\nRef: review/06-demo.md, review/02-api-surface.md","notes":"Completed in this branch. HSM APIs exported from matchina/hsm subpath.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-25T12:18:05.173175-06:00","updated_at":"2025-12-25T16:36:43.460025-06:00","closed_at":"2025-12-25T16:36:43.460032-06:00","dependency_count":0,"dependent_count":0}
{"id":"matchina-t6i","title":"Bug clicking into nested on http://localhost:4321/matchina/examples/hsm-checkout","description":"CheckoutViewNested.tsx:109 Uncaught TypeError: Cannot read properties of undefined (reading 'key')\n    at PaymentSection (CheckoutViewNested.tsx:109:26)","status":"closed","priority":4,"issue_type":"bug","created_at":"2025-12-27T14:05:12.962527-06:00","updated_at":"2025-12-27T14:15:19.209045-06:00","closed_at":"2025-12-27T14:15:19.209045-06:00","close_reason":"Closed","dependency_count":0,"dependent_count":0}
{"id":"matchina-1ve","title":"Docs: Add StoreMachine guide and interactive example","description":"StoreMachine is a major feature but lacks:\\n- Dedicated guide page in docs/src/content/docs/guides/\\n- Interactive example in docs/src/code/examples/\\n- Comparison with FactoryMachine (when to use which)\\nRef: review/05-docs.md, review/06-demo.md","notes":"Blocker removed - HSM now in stacked branches. Independent docs work.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-25T12:18:11.152582-06:00","updated_at":"2025-12-26T07:53:15.736386-06:00","closed_at":"2025-12-26T07:53:15.736386-06:00","close_reason":"Closed","dependency_count":1,"dependent_count":0}
